!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).ANSWERS=t()}(this,function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}var c="get",h="post",p=function(){function e(){t(this,e)}return i(e,[{key:"get",value:function(e,t,n){return this.request(c,this.encodeParams(e,t),n)}},{key:"post",value:function(e,t,n){return this.request(h,e,Object.assign({body:JSON.stringify(t)},n))}},{key:"request",value:function(e,t,n){return fetch(t,Object.assign({method:"get",credentials:"include"},n))}},{key:"encodeParams",value:function(e,t){var n=e.indexOf("?")>-1,i="";for(var r in t)n?i+="&":(n=!0,i+="?"),i+=r+"="+t[r];return encodeURI(e+i)}}]),e}(),f=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),this._requester=new p,this._baseUrl=n.baseUrl||null,this._endpoint=n.endpoint||null,this._apiKey=n.apiKey||null,this._version=n.version||20190101,this._params=n.params||{}}return i(e,[{key:"get",value:function(){return this._requester.get(this._baseUrl+this._endpoint,this.params(this._params))}},{key:"params",value:function(e){return Object.assign({v:this._version,api_key:this._apiKey},e||{})}}]),e}(),d=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e);new URL(window.location.toString()).searchParams.get("local");this._requester=new p,this._baseUrl=this._isLocal?"http://"+window.location.hostname:"https://liveapi.yext.com",this._apiKey=n.apiKey||null,this._answersKey=n.answersKey||null,this._version=n.version||20190101}return i(e,[{key:"verticalQuery",value:function(e,t){return new f({baseUrl:this._baseUrl,endpoint:"/v2/accounts/me/answers/vertical/query",apiKey:this._apiKey,version:this._version,params:{input:e,answersKey:this._answersKey,verticalKey:t}}).get().then(function(e){return e.json()})}},{key:"query",value:function(e){return new f({baseUrl:this._baseUrl,endpoint:"/v2/accounts/me/answers/query",apiKey:this._apiKey,version:this._version,params:{input:e,answersKey:this._answersKey}}).get().then(function(e){return e.json()})}}]),e}(),y=function(){function e(){t(this,e)}return i(e,null,[{key:"clean",value:function(e,t){return t.sections&&0===t.sections.length&&delete t.sections,t.sections&&1===t.sections.length&&0===t.sections[0].results.length&&delete t.sections,r({},e,t)}},{key:"universal",value:function(t){for(var n=t.results,i=[],r=0;r<n.length;r++){var s=n[r].value,a=n[r].matchedSubstrings;i.push(e.highlight(s,a))}return e.clean("autocomplete",{sections:[{results:i}]})}},{key:"highlight",value:function(e,t){if(!t||0===t.length)return{shortValue:e,highlightedValue:e};t.sort(function(e,t){return e.offset<t.offset?-1:e.offset>t.offset?1:0});for(var n="",i=0,r=0;r<t.length;r++){var s=Number(t[r].offset),a=s+t[r].length;n+=[e.slice(i,s),"<strong>",e.slice(s,a),"</strong>"].join(""),r===t.length-1&&a<e.length&&(n+=e.slice(a)),i=a}return{shortValue:e,highlightedValue:n}}},{key:"vertical",value:function(t,n){var i="autocomplete."+n,r=t.sections;return e.clean(i,{sections:r})}}]),e}(),v=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e);new URL(window.location.toString()).searchParams.get("local");this._baseUrl=this._isLocal?"http://"+window.location.hostname:"https://liveapi.yext.com",this._apiKey=n.apiKey||null,this._answersKey=n.answersKey||null,this._version=n.version||20190101}return i(e,[{key:"query",value:function(e,t,n){return t||n?this._queryVeritcal(e,t,n):this._queryUniversal(e)}},{key:"_queryVeritcal",value:function(e,t,n){var i=new f({baseUrl:this._baseUrl,endpoint:"/v2/accounts/me/entities/autocomplete",apiKey:this._apiKey,version:this._version,params:{input:e,experienceKey:t,barKey:n}});return i.get().then(function(e){return e.json()}).then(function(e){return y.vertical(e.response,i._params.barKey)}).catch(function(e){return console.error(e)})}},{key:"_queryUniversal",value:function(e){return new f({baseUrl:this._baseUrl,endpoint:"/v2/accounts/me/answers/autocomplete",apiKey:this._apiKey,version:this._version,params:{input:e,answersKey:this._answersKey}}).get(e).then(function(e){return e.json()}).then(function(e){return y.universal(e.response)}).catch(function(e){return console.error(e)})}}]),e}(),m=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),Object.assign(this,n)}return i(e,null,[{key:"from",value:function(t){for(var n=[],i=0;i<t.length;i++)n.push(new e(t[i].data||t[i]));return n}}]),e}(),_=function(){function e(n,i){t(this,e),this.verticalConfigId=n.verticalConfigId||null,this.resultsCount=n.resultsCount||0,this.encodedState=n.encodedState||"",this.appliedQueryFilters=n.appliedQueryFilters||null,this.facets=n.facets||null,this.results=m.from(n.results),this.map=e.parseMap(n.results),this.verticalURL=i||null}return i(e,null,[{key:"parseMap",value:function(e){for(var t=[],n={},i=0;i<e.length;i++){var r=e[i].data||e[i];r&&r.yextDisplayCoordinate&&(n.latitude||(n={latitude:r.yextDisplayCoordinate.latitude,longitude:r.yextDisplayCoordinate.longitude}),t.push({label:t.length+1,latitude:r.yextDisplayCoordinate.latitude,longitude:r.yextDisplayCoordinate.longitude}))}return{mapCenter:n,mapMarkers:t}}},{key:"from",value:function(t,n){var i=[];if(!t)return i;if(!Array.isArray(t))return new e(t);for(var r=0;r<t.length;r++)i.push(new e(t[r],n[t[r].verticalConfigId]));return i}}]),e}(),g=function(){function e(n){t(this,e),this.queryId=n.queryId||null,this.sections=n.sections||[]}return i(e,null,[{key:"from",value:function(t,n){return new e({queryId:t.queryId,sections:_.from(t.modules,n)})}}]),e}(),b=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),Object.assign(this,n)},k=function(){function e(n){t(this,e),this.tabOrder=n||[]}return i(e,null,[{key:"from",value:function(t){var n=[];if(!t||!Array.isArray(t))return n;for(var i=0;i<t.length;i++)n.push(t[i].verticalConfigId);return new e(n)}}]),e}(),w=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),Object.assign(this,n)}return i(e,null,[{key:"from",value:function(t){return new e(_.from(t))}}]),e}(),C=function(){function e(){t(this,e)}return i(e,null,[{key:"transform",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.response;return{navigation:k.from(n.modules),directAnswer:new b(n.directAnswer),universalResults:g.from(n,t)}}},{key:"transformVertical",value:function(e){return{verticalResults:w.from(e.response)}}}]),e}(),S=function(){function e(){t(this,e),this._listeners={}}return i(e,[{key:"on",value:function(e,t,n){if("function"!=typeof t)throw new Error("callback handler should be of type {function}");return void 0===this._listeners[e]&&(this._listeners[e]=[]),this._listeners[e].push({event:e,cb:t,once:n||!1}),this}},{key:"once",value:function(e,t){return this.on(e,t,!0)}},{key:"off",value:function(e){return delete this._listeners[e],this}},{key:"emit",value:function(e,t){var n=this._listeners[e];if(void 0!==n){for(var i=[],r=0;r<n.length;r++)n[r].cb(t),!0!==n[r].once&&i.push(n[r]);return this._listeners[e]=i,this}}}]),e}(),I=function(e){function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t(this,n),(i=u(this,a(n).call(this)))._id=e,i._history=[],i._data={},i.set(r),i}return s(n,S),i(n,[{key:"set",value:function(e){e=e||{},void 0===this._data&&(this._data={}),this.capturePrevious();var t=Object.keys(e),n=t.length,i=!1;0===t.length&&(this._data=e,i=!0);for(var r=0;r<n;r++){var s=t[r],a=e[t[r]];this._data[s]!==a&&(this._data[s]=a,i=!0)}return i&&this.emit("update",this._data),this}},{key:"capturePrevious",value:function(){void 0===this._history&&(this._history=[]),this._history.length+1>5&&this._history.shift(),this._history.push(JSON.stringify(this._data||{}))}},{key:"undo",value:function(){var e={};this._previous.length>0&&(e=JSON.parse(this._previous.pop())),this._data.set(e)}},{key:"raw",value:function(){return this._data}}]),n}(),K=function(){function e(){t(this,e),this._moduleDataContainer={},this._futureListeners={}}return i(e,[{key:"init",value:function(){}},{key:"insert",value:function(e){if(void 0!==e)for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n];void 0===this._moduleDataContainer[i]&&(this._moduleDataContainer[i]=new I(i),this._applyFutureListeners(i)),this._moduleDataContainer[i].set(e[i])}}},{key:"insertUniversalResults",value:function(e){this.insert(C.transform(e))}},{key:"getState",value:function(e){return this._moduleDataContainer[e]?this._moduleDataContainer[e].raw():{}}},{key:"on",value:function(e,t,n){return void 0===this._moduleDataContainer[t]?(void 0===this._futureListeners[t]&&(this._futureListeners[t]=[]),void this._futureListeners[t].push({event:e,cb:n})):(this._moduleDataContainer[t].on(e,n),this)}},{key:"off",value:function(e,t,n){return void 0===this._moduleDataContainer[t]?(void 0!==this._futureListeners[t]&&this._futureListeners[t].pop(),this):(this._moduleDataContainer[t].off(e,n),this)}},{key:"_applyFutureListeners",value:function(e){var t=this._futureListeners[e];if(t){for(var n=0;n<t.length;n++){var i=t[n];this.on(i.event,e,i.cb)}delete this._futureListeners[e]}}}]),e}(),q=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t(this,e),"string"!=typeof n.apiKey)throw new Error("Missing required `apiKey`. Type must be {string}");if("string"!=typeof n.answersKey)throw new Error("Missing required `answersKey`. Type must be {string}");this._apiKey=n.apiKey,this._answersKey=n.answersKey,this.storage=new K,this._searcher=new d({apiKey:this._apiKey,answersKey:this._answersKey}),this._autoComplete=new v({apiKey:this._apiKey,answersKey:this._answersKey})}return i(e,[{key:"verticalSearch",value:function(e,t){var n=this;return this._searcher.verticalQuery(e,t).then(function(e){return C.transformVertical(e)}).then(function(e){n.storage.insert(e)}).catch(function(e){return console.error(e)})}},{key:"search",value:function(e,t){var n=this;return this._searcher.query(e).then(function(e){return C.transform(e,t)}).then(function(e){n.storage.insert(e)}).catch(function(e){return console.error(e)})}},{key:"autoComplete",value:function(e,t,n){var i=this;return this._autoComplete.query(e,t,n).then(function(e){i.storage.insert(e)})}},{key:"on",value:function(e,t,n){return this.storage.on(e,t,n)}}]),e}(),x=function(){function e(){if(t(this,e),!e.setInstance(this))return e.getInstance();this._componentRegistry={},this._activeComponents={},this._core=null,this._renderer=null}return i(e,[{key:"setRenderer",value:function(e){return this._renderer=e,this}},{key:"setCore",value:function(e){return this._core=e,this}},{key:"register",value:function(e){return this._componentRegistry[e.type]=e,this}},{key:"create",value:function(e,t){t=Object.assign({core:this._core,renderer:this._renderer,componentManager:this},t);var n=new this._componentRegistry[e](t).init(t);if(this._activeComponents[e]=n,null!==this._core.storage){if(void 0===n.moduleId||null===n.moduleId)return n;this._core.storage.on("update",n.moduleId,function(e){n.setState(e)})}return n}},{key:"getActiveComponent",value:function(e){return this._activeComponents[e]}}],[{key:"setInstance",value:function(e){return!this.instance&&(this.instance=e,!0)}},{key:"getInstance",value:function(){return this.instance}}]),e}(),L=function(){function e(){t(this,e)}return i(e,[{key:"render",value:function(e,t){return e}},{key:"registerHelper",value:function(e,t){}},{key:"compile",value:function(e){}}]),e}(),O=window.document,M=new DOMParser,U=function(){function e(){t(this,e)}return i(e,null,[{key:"create",value:function(e){return M.parseFromString(e,"text/html").body}},{key:"query",value:function(e,t){return void 0===t&&(t=e,e=O),t instanceof HTMLElement||t instanceof Window||t instanceof HTMLDocument?t:e.querySelector(t)}},{key:"queryAll",value:function(e,t){return void 0===t&&(t=e,e=O),t instanceof HTMLElement||t instanceof HTMLDocument||t instanceof Window?t:e.querySelectorAll(t)}},{key:"onReady",value:function(t){"complete"!==O.readyState&&"loaded"!==O.readyState&&"interactive"!==O.readyState?e.on(O,"DOMContentLoaded",t):t()}},{key:"createEl",value:function(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=O.createElement(t),r=Object.keys(n),s=0;s<r.length;s++)"class"!==r[s]?i[r[s]]=n[r[s]]:e.addClass(i,n[r[s]]);return i}},{key:"append",value:function(t,n){void 0===n&&(n=t,t=O),"string"==typeof t&&(t=e.query(t)),"string"==typeof n?t.insertAdjacentHTML("afterBegin",n):t.appendChild(n)}},{key:"addClass",value:function(e,t){for(var n=t.split(","),i=n.length,r=0;r<i;r++)e.classList.add(n[r])}},{key:"empty",value:function(e){e.innerHTML=""}},{key:"css",value:function(t,n){var i=e.query(t);for(var r in n)i.style[r]=n[r]}},{key:"attr",value:function(t,n,i){e.query(t).setAttribute(n,i)}},{key:"trigger",value:function(t,n,i){var r=new Event(n,Object.assign({bubbles:!0,cancelable:!0},i||{}));e.query(t).dispatchEvent(r)}},{key:"on",value:function(t,n,i){e.query(t).addEventListener(n,i)}},{key:"off",value:function(t,n,i){e.query(t).removeEventListener(n,i)}},{key:"delegate",value:function(t,n,i,r){var s=e.query(t);s.addEventListener(i,function(e){for(var t=e.target;!t.isEqualNode(s);){if(t.matches(n)){r(e,t);break}t=t.parentNode}})}}]),e}(),R=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t(this,e),!e.setInstance(this))return e.getInstance();var i=new URL(window.location.toString()).searchParams.get("local");this._templateUrl=n.templateUrl||(i?"../dist/answerstemplates.compiled.min.js":"https://assets.sitescdn.net/answers/answerstemplates.compiled.min.js"),this._templates={},this._onLoaded=function(){},this._init()}return i(e,[{key:"_init",value:function(){this.fetchTemplates()}},{key:"fetchTemplates",value:function(){if(!U.query("#yext-answers-templates")){var e=this;return new Promise(function(t,n){var i=U.createEl("script",{id:"yext-answers-templates",onload:t,onerror:n,async:!0,src:e._templateUrl});U.append("body",i)}).then(function(e){console.log("Templates loaded successfully!")}),this}}},{key:"register",value:function(e){return this._templates=e,this._onLoaded(this._templates),this}},{key:"onLoaded",value:function(e){return this._onLoaded=e,this}},{key:"get",value:function(e){return this._templates[e]}},{key:"getTemplates",value:function(){return this._templates}}],[{key:"setInstance",value:function(e){return!this.instance&&(this.instance=e,!0)}},{key:"getInstance",value:function(e){return this.instance}}]),e}(),E={SOY:L,Handlebars:function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=u(this,a(n).call(this)))._handlebars=i._hb||null,e._templates=i||{},e}return s(n,L),i(n,[{key:"init",value:function(e){this._handlebars=e._hb,this._templates=e,this._registerCustomHelpers()}},{key:"registerHelper",value:function(e,t){this._handlebars.registerHelper(e,t)}},{key:"compile",value:function(e){return"string"!=typeof e?"":this._handlebars.compile(e)}},{key:"render",value:function(e,t){if(null!==e.template)return e.template(t);try{return this._templates[e.templateName](t)}catch(t){throw new Error("Can not find/render template: "+e.templateName,t)}}},{key:"_registerCustomHelpers",value:function(){this.registerHelper("ifeq",function(e,t,n){return e==t?n.fn(this):n.inverse(this)}),this.registerHelper("ifnoteq",function(e,t,n){return e!=t?n.fn(this):n.inverse(this)}),this.registerHelper("formatPhoneNumber",function(e){var t=(""+e).replace(/\D/g,"").match(/^(1|)?(\d{3})(\d{3})(\d{4})$/);return t?[t[1]?"+1 ":"","(",t[2],") ",t[3],"-",t[4]].join(""):null}),this.registerHelper("mapBox",function(e,t,n){for(var i="",r=e.mapMarkers,s=e.mapCenter,a=t.width||600,o=t.height||200,u=t.zoom||9,l=0;l<r.length;l++){var c=r[l];l>0&&(i+=","),i+="pin-s-".concat(c.label,"(").concat(c.longitude,",").concat(c.latitude,")")}return'<img src="https://api.mapbox.com/styles/v1/mapbox/streets-v11/static/'.concat(i,"/").concat(s.longitude,",").concat(s.latitude,",").concat(u,"/auto/").concat(a,"x").concat(o,"?access_token=").concat(t.apiKey,'">')}),this.registerHelper("googleMap",function(e,t,n){for(var i="",r=e.mapMarkers,s=t.width||600,a=t.height||200,o=(t.zoom,0);o<r.length;o++){var u=r[o];i+="&markers=label:".concat(u.label,"|").concat(u.latitude,",").concat(u.longitude)}return'<img src="https://maps.googleapis.com/maps/api/staticmap?'.concat(i,"&size=").concat(s,"x").concat(a,"&key=").concat(t.apiKey,'">')}),this.registerHelper("assign",function(e,t,n){var i=arguments;(n=i[i.length-1]).data.root||(n.data.root={});for(var r="",s=1;s<i.length-1;s++)r+=i[s];n.data.root[e]=r})}}]),n}()},j=function(e){function n(e){var i;return t(this,n),(i=u(this,a(n).call(this)))._state=e||{},i}return s(n,S),i(n,[{key:"init",value:function(e,t){this._set(e,t)}},{key:"set",value:function(e,t){this._set(e,t),this.emit("update")}},{key:"_set",value:function(e,t){void 0===t?this._state=e:this._state[e]=t}},{key:"update",value:function(e){this._state=e,this.emit("update")}},{key:"get",value:function(e){return void 0===e?this._state:this._state[e]}},{key:"has",value:function(e){return void 0!==this._state[e]}},{key:"asJSON",value:function(){return this._state}}]),n}(),P=function(){function n(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t(this,n),"object"===e(i)&&(i=(r=i).type),this.moduleId=null,this._opts=r,this._type=this.constructor.name,this._parent=r.parent||null,this._children=[],this._state=new j(r.state),this.core=r.core||null,this.componentManager=r.componentManager||null,null===this._parent){if("string"!=typeof r.container)throw new Error("Missing `container` option for component configuration. Must be of type `string`.");this._container=U.query(r.container)||null}else this._container=U.query(this._parent._container,r.container),null===this._container&&(this._container=U.createEl("div",{class:r.container.substring(1,r.container.length)}),U.append(this._parent._container,this._container));if(null===this._container)throw new Error("Cannot find container DOM node: "+r.container);this._className=r.class||"component",this._render=r.render||null,this._renderer=r.renderer||E.Handlebars,this._template=r.template?this._renderer.compile(r.template):null,this._templateName=r.templateName||"default",this._isMounted=!1,this.transformData=r.transformData||this.transformData||function(){},this.onCreate=r.onCreate||this.onCreate||function(){},this.onMount=r.onMount||this.onMount||function(){},this.onUpdate=r.onUpdate||this.onUpdate||function(){}}return i(n,[{key:"init",value:function(e){var t=this;return this.setState(e.data||e.state||{}),this.onCreate(),this._state.on("update",function(){t.onUpdate(),t.mount()}),U.addClass(this._container,this._className),this}},{key:"setState",value:function(e){return this._state.set(e),this}},{key:"getState",value:function(e){return this._state.get(e)}},{key:"hasState",value:function(e){return this._state.has(e)}},{key:"transformData",value:function(e){return e}},{key:"addChild",value:function(e,t,n){var i=this.componentManager.create(t,Object.assign({parent:this,data:e},n||{},{_parentOpts:this._opts}));return this._children.push(i),i}},{key:"setRender",value:function(e){return this._render=e,this}},{key:"setRenderer",value:function(e){return this._renderer=E[e],this}},{key:"setTemplate",value:function(e){this._template=this._renderer.compile(e)}},{key:"unMount",value:function(){U.empty(this._container)}},{key:"mount",value:function(){return this._container?(this.unMount(),!1===this.beforeMount()?this:(U.append(this._container,this.render(this._state.asJSON())),this._isMounted=!0,this.onMount(this),this)):this}},{key:"render",value:function(e){this.beforeRender(),e=this.transformData(e)||this.transformData(this._state.get());var t="";if("function"==typeof this._render){if("string"!=typeof(t=this._render(e)))throw new Error("Render method must return HTML as type {string}")}else t=this._renderer.render({template:this._template,templateName:this._templateName},e);var n=U.create(t);this._children=[];var i=U.query(n,"[data-component]");if(null!=i){var r=i.dataset.component,s=e[i.dataset.prop];if(Array.isArray(s)){for(var a=[],o=0;o<s.length;o++){var u=this.addChild(s[o],r);a.push(u.render(s[o]))}U.append(i,a.join(""))}}return this.afterRender(),n.innerHTML}},{key:"onCreate",value:function(e){}},{key:"onUpdate",value:function(e){}},{key:"beforeRender",value:function(e){}},{key:"afterRender",value:function(e){}},{key:"onMount",value:function(e){}},{key:"onUnMount",value:function(e){}},{key:"beforeMount",value:function(e){}},{key:"onDestroy",value:function(e){}}],[{key:"type",get:function(){return"Component"}}]),n}(),T=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,n),(e=u(this,a(n).call(this,i))).moduleId="navigation",e._templateName="navigation/navigation",e._tabOrder=[],e._tabs={};for(var r=0;r<i.tabs.length;r++){var s=i.tabs[r];void 0===s.configId&&void 0===e._tabs[s.configId]&&(s.configId=s.url),s.isFirst?e._tabOrder.unshift(s.configId):e._tabOrder.push(s.configId),e._tabs[s.configId]={label:s.label,configId:s.configId,url:s.url,baseUrl:s.url,isFirst:!0===s.isFirst,isActive:!0===s.isActive}}return e}return s(n,P),i(n,[{key:"getUrlParams",value:function(){return new URLSearchParams(window.location.search.substring(1))}},{key:"generateTabUrl",value:function(e){var t=this.getUrlParams();return t.toString().length>0&&(e.url=e.baseUrl+"?"+t.toString()),e}},{key:"setState",value:function(e){void 0!==e.tabOrder&&(this._tabOrder=e.tabOrder);for(var t=[],i=0;i<this._tabOrder.length;i++){var r=this._tabs[this._tabOrder[i]];void 0!==r&&t.push(this.generateTabUrl(r))}for(var s in this._tabs)if(this._tabOrder.indexOf(s)<=-1){var o=this.generateTabUrl(this._tabs[s]);if(o.isFirst){t.unshift(o);continue}t.push(o)}return l(a(n.prototype),"setState",this).call(this,{tabs:t})}},{key:"render",value:function(e){return l(a(n.prototype),"render",this).call(this,e)}}],[{key:"type",get:function(){return"Navigation"}}]),n}(),H=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=u(this,a(n).call(this,i)))._templateName="search/search",e._barKey=i.barKey||null,e._verticalKey=i.verticalKey||null,e._formEl=i.formSelector||"form",e._inputEl=i.inputEl||".js-yext-query",e.title=i.title||"Answers Universal Search",e.searchText=i.searchText||"What are you interested in?",e.promptHeader=i.promptHeader||null,e.autoFocus=!0===i.autoFocus,e.redirectUrl=i.redirectUrl||null,e.query=i.query||e.getUrlParams().get("query")||"",e}return s(n,P),i(n,[{key:"onCreate",value:function(){this.query&&this.query.length>0&&this.search(this.query),this.bindBrowserHistory()}},{key:"onMount",value:function(){this.initSearch(this._formEl),this.initAutoComplete(this._inputEl),!0===this.autoFocus&&0===this.query.length&&U.query(this._container,this._inputEl).focus()}},{key:"initSearch",value:function(e){var t=this;this._formEl=e;var n=U.query(this._container,e);if(!n)throw new Error("Could not initialize SearchBar; Can not find {HTMLElement} `",this._formEl,"`.");U.on(n,"submit",function(e){e.preventDefault();var i=n.querySelector(t._inputEl).value,r=t.getUrlParams();return r.set("query",i),"string"==typeof t.redirectUrl?(window.location.href=t.redirectUrl+"?"+r.toString(),!1):(window.history.pushState({query:i},i,"?"+r.toString()),t.search(i),!1)})}},{key:"initAutoComplete",value:function(e){this._inputEl=e;this.componentManager.create("AutoComplete",{parent:this,container:".yext-search-autocomplete",barKey:this._barKey,experienceKey:this._experienceKey,promptHeader:this.promptHeader,originalQuery:this.query,inputEl:e,onSubmit:function(){U.trigger("form","submit")}})}},{key:"search",value:function(e){if(this._verticalKey)return this.core.verticalSearch(e,this._verticalKey);var t=this.componentManager.getActiveComponent("Navigation");if(t){var n=t.getState("tabs"),i={};if(n&&Array.isArray(n))for(var r=0;r<n.length;r++){var s=this.getUrlParams(n[r].url.split("?")[1]);s.set("query",e);var a=n[r].baseUrl;s.toString().length>0&&(a+="?"+s.toString()),i[n[r].configId]=a}return this.core.search(e,i)}return this.core.search(e)}},{key:"setState",value:function(e){return l(a(n.prototype),"setState",this).call(this,Object.assign({title:this.title,searchText:this.searchText,query:this.query},e))}},{key:"getUrlParams",value:function(e){return e=e||window.location.search.substring(1),new URLSearchParams(e)}},{key:"bindBrowserHistory",value:function(){var e=this;U.on(window,"popstate",function(){e.query=e.getUrlParams().get("query"),e.setState({query:e.query}),e.search(e.query)})}}],[{key:"type",get:function(){return"SearchBar"}}]),n}(),N=9,D=13,A=16,Q=17,F=18,z=27,B=37,J=39,V=38,W=40,Y=91,$=92,G=93,X=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,n),(e=u(this,a(n).call(this,i)))._barKey=i.barKey||null,e._experienceKey=i.experienceKey||null,e._inputEl=i.inputEl||".js-yext-query";var r="autocomplete";return void 0!==e._barKey&&null!==e._barKey&&(r="autocomplete."+e._barKey),e.moduleId=r,e._templateName="search/autocomplete",e._originalQuery=i.originalQuery||"",e._sectionIndex=0,e._resultIndex=-1,e.promptHeader=i.promptHeader||null,e._onSubmit=i.onSubmit||function(){},e}return s(n,P),i(n,[{key:"setState",value:function(e){l(a(n.prototype),"setState",this).call(this,Object.assign(e,{sectionIndex:this._sectionIndex,resultIndex:this._resultIndex,promptHeader:0===this._originalQuery.length?this.promptHeader:null}))}},{key:"updateState",value:function(){this.setState(this._state.get())}},{key:"onCreate",value:function(){var e=this,t=U.query(this._parent._container,this._inputEl);if(!t)throw new Error("Could not initialize AutoComplete. Can not find {HTMLElement} `",this._inputEl,"`.");U.attr(t,"autoComplete","off"),U.on(t,"blur",function(){e.close()}),U.on(t,"focus",function(){e.reset(),e.core.autoComplete(t.value,e._experienceKey,e._barKey)}),U.on(t,"keydown",function(t){e.handleNavigateResults(t.keyCode,t)}),U.delegate(this._container,".js-yext-autocomplete-option","mousedown",function(t,n){var i=n.dataset,r=i.value;JSON.parse(i.filter);e.updateQuery(r),e._onSubmit(),e.close()}),U.on(t,"keyup",function(n){e.handleTyping(n.keyCode,t.value,n)})}},{key:"close",value:function(){this.setState({}),this.reset()}},{key:"reset",value:function(){this._selectedIndex=0,this._resultIndex=-1,this.updateState()}},{key:"updateQuery",value:function(e){void 0===e&&(e=this._state.get("sections")[this._sectionIndex].results[this._resultIndex].shortValue);U.query(this._parent._container,".js-yext-query").value=e}},{key:"handleTyping",value:function(e,t,n){if(!([W,V,Q,F,A,B,J,Y,$,G].indexOf(e)>-1))return e===z?(this.updateQuery(this._originalQuery),void this.close()):void(e!==D&&e!==N?(this._originalQuery=t,this.reset(),this.core.autoComplete(t,this._experienceKey,this._barKey)):this.close())}},{key:"handleNavigateResults",value:function(e,t){var n=this._state.get("sections");if(!(void 0===n||n.length<=0)){var i=n[this._sectionIndex].results;return e===V?(t.preventDefault(),this._resultIndex<=0?this._sectionIndex>0?(this._sectionIndex--,this._resultIndex=n[this._sectionIndex].results.length-1,this.updateQuery(),void this.updateState()):(this.updateQuery(this._originalQuery),void this.reset()):(this._resultIndex--,this.updateState(),void this.updateQuery())):e===W?this._resultIndex>=i.length-1?(this._sectionIndex<n.length-1&&(this._sectionIndex++,this._resultIndex=0),this.updateQuery(),void this.updateState()):(this._resultIndex++,this.updateQuery(),void this.updateState()):void 0}}}],[{key:"type",get:function(){return"AutoComplete"}}]),n}(),Z=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=u(this,a(n).call(this,i))).moduleId="directAnswer",e._templateName="results/directanswer",e}return s(n,P),i(n,[{key:"beforeMount",value:function(){return!!this.hasState("answer")}}],[{key:"type",get:function(){return"DirectAnswer"}}]),n}(),ee=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=u(this,a(n).call(this,i)))._templateName="results/resultsitem",e}return s(n,P),i(n,null,[{key:"type",get:function(){return"ResultsItemComponent"}}]),n}(),te=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=u(this,a(n).call(this,i)))._templateName="results/locationresultsitem",e}return s(n,ee),i(n,null,[{key:"type",get:function(){return"LocationResultsItemComponent"}}]),n}(),ne=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=u(this,a(n).call(this,i)))._templateName="results/eventresultsitem",e}return s(n,ee),i(n,null,[{key:"type",get:function(){return"EventResultsItemComponent"}}]),n}(),ie=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=u(this,a(n).call(this,i)))._templateName="results/peopleresultsitem",e}return s(n,ee),i(n,null,[{key:"type",get:function(){return"PeopleResultsItemComponent"}}]),n}(),re="event",se="location",ae="people",oe=function(e){function n(){var e,i,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(i=u(this,a(n).call(this,s))).moduleId="verticalResults",i._templateName="results/results",i.limit=s.limit||5,i._itemConfig=(r(e={global:{render:null,template:null}},ne.type,{render:null,template:null}),r(e,te.type,{render:null,template:null}),r(e,ie.type,{render:null,template:null}),e),void 0===s.renderItem&&void 0!==s._parentOpts&&(s.renderItem=s._parentOpts.renderItem),void 0===s.itemTemplate&&void 0!==s._parentOpts&&(s.itemTemplate=s._parentOpts.itemTemplate),i.configureItem({render:s.renderItem,template:s.itemTemplate}),i}return s(n,P),i(n,[{key:"mount",value:function(){return Object.keys(this.getState()).length>0&&l(a(n.prototype),"mount",this).call(this),this}},{key:"setState",value:function(e,t){return 0===Object.keys(e).length?this:l(a(n.prototype),"setState",this).call(this,Object.assign(e,{includeMap:this._opts.includeMap,mapConfig:this._opts.mapConfig}),t)}},{key:"configureItem",value:function(e){if("function"==typeof e.render)this._itemConfig.global.render=e.render;else for(var t in e.render)this.setItemRender(t,e.render[t]);if("string"==typeof e.template)this._itemConfig.global.template=e.template;else for(var n in e.template)this.setItemTemplate(n,e.template[n])}},{key:"setItemTemplate",value:function(e,t){var n=this.getItemComponent(e);this._itemConfig[n.type].template=t}},{key:"setItemRender",value:function(e,t){var n=this.getItemComponent(e);this._itemConfig[n.type].render=t}},{key:"getItemComponent",value:function(e){var t=ee;switch(e){case re:t=ne;break;case se:t=te;break;case ae:t=ie}return t}},{key:"addChild",value:function(e,t){var i=this.getItemComponent(e.type);i&&(t=i.type);var r=l(a(n.prototype),"addChild",this).call(this,e,t),s=this._itemConfig.global,o=this._itemConfig[i.type],u="function"==typeof s.render,c="string"==typeof s.template;return u&&r.setRender(s.render),c&&r.setTemplate(s.template),o?(!u&&o.render&&r.setRender(o.render),!c&&o.template&&r.setTemplate(o.template),r):r}}],[{key:"type",get:function(){return"VerticalResults"}}]),n}(),ue=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=u(this,a(n).call(this,i))).moduleId="universalResults",e._templateName="results/universalresults",e._limit=i.limit||10,e}return s(n,P),i(n,[{key:"init",value:function(e){return l(a(n.prototype),"init",this).call(this,e),this}},{key:"addChild",value:function(e,t){var i=this.getChildConfig([e.verticalConfigId]);return l(a(n.prototype),"addChild",this).call(this,e,t,i)}},{key:"getChildConfig",value:function(e){return void 0===this._opts.config?{}:this._opts.config[e]||this._opts.config}}],[{key:"type",get:function(){return"UniversalResults"}}]),n}(),le=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),this._apiKey=n.mapApiKey,this._height=n.height||"100%",this._width=n.width||"100%",this._zoom=n.zoom||20,this._map=null,this._isLoaded=!1}return i(e,[{key:"isLoaded",value:function(){return this._isLoaded}},{key:"loadJS",value:function(){throw new Error("Unimplemented Method: loadJS")}},{key:"init",value:function(e){throw new Error("Unimplemented Method: init")}}]),e}(),ce=function(e){function n(e){return t(this,n),u(this,a(n).call(this,e))}return s(n,le),i(n,[{key:"loadJS",value:function(e){var t=this,n=U.createEl("script",{id:"yext-map-js",onload:function(){t._isLoaded=!0,e()},async:!0,src:"https://maps.googleapis.com/maps/api/js?key="+this._apiKey});U.append("body",n)}},{key:"init",value:function(e,t){var n=this;if(!t||t.mapMarkers.length<=0)return this._map=null,this;setTimeout(function(){var i=U.query(e);U.css(i,{width:n._width,height:n._height}),n.map=new google.maps.Map(i,{zoom:n._zoom});var r=new google.maps.LatLngBounds;if(t&&t.mapMarkers.length>0)for(var s=t.mapMarkers,a=0;a<s.length;a++){var o=new google.maps.Marker({map:n.map,position:{lat:s[a].latitude,lng:s[a].longitude}});r.extend(o.position)}n.map.fitBounds(r)},100)}}]),n}(),he=function(e){function n(e){return t(this,n),u(this,a(n).call(this,e))}return s(n,le),i(n,[{key:"loadJS",value:function(e){var t=this,n=U.createEl("script",{id:"yext-map-js",onload:function(){t._isLoaded=!0,mapboxgl.accessToken=t._apiKey,e()},async:!0,src:"https://api.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.js"}),i=U.createEl("link",{id:"yext-map-css",rel:"stylesheet",href:"https://api.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.css"});U.append("body",i),U.append("body",n)}},{key:"init",value:function(e,t){var n=this;if(!t||t.mapMarkers.length<=0)return this._map=null,this;var i=U.query(e);U.css(i,{width:this._width,height:this._height}),this._map=new mapboxgl.Map({container:i,zoom:this._zoom,style:"mapbox://styles/mapbox/streets-v9",center:[t.mapCenter.longitude,t.mapCenter.latitude]}),this._map.on("load",function(){if(t&&t.mapMarkers.length>0)for(var e=t.mapMarkers,i=0;i<e.length;i++){var r=new mapboxgl.LngLat(e[i].longitude,e[i].latitude);(new mapboxgl.Marker).setLngLat(r).addTo(n._map)}})}}]),n}(),pe=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=u(this,a(n).call(this,i))).moduleId="verticalResults",e._templateName="results/map",e._mapProvider=i.mapProvider,e._map=null,e}return s(n,P),i(n,[{key:"onCreate",value:function(){var e=this;"google"===this._mapProvider?this._map=new ce(this._opts):this._map=new he(this._opts),this._map.loadJS(function(){var t=e.getState("map");void 0!==t&&e._map.init(e._container,t)})}},{key:"onMount",value:function(){this._map.isLoaded()&&this._map.init(this._container,this.getState("map"))}},{key:"setState",value:function(e,t){return 0===Object.keys(e).length?this:l(a(n.prototype),"setState",this).call(this,Object.assign(e,{mapConfig:{mapProvider:this._mapProvider,mapApiKey:this._mapApiKey}}),t)}}],[{key:"type",get:function(){return"Map"}}]),n}(),fe=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=u(this,a(n).call(this,i))).moduleId="universalResults",e._templateName="questions/submission",e._formEl=i.formSelector||"form",e._emailLabel=i.emailLabel||"*Email Address:",e._nameLabel=i.nameLabel||"Name:",e._questionLabel=i.questionLabel||"*What is your question?",e._privacyPolicyLabel=i.privacyPolicyLabel||"I agree to our Privacy Policy:",e._buttonLabel=i.buttonLabel||"Submit",e}return s(n,P),i(n,[{key:"beforeMount",value:function(){return!0===this.getState("hasQueried")}},{key:"onMount",value:function(){this.initSubmit(this._formEl)}},{key:"initSubmit",value:function(e){this._formEl=e;var t=U.query(this._container,this._formEl);U.on(t,"submit",function(e){e.preventDefault()})}},{key:"setState",value:function(e,t){return l(a(n.prototype),"setState",this).call(this,{hasQueried:void 0!==e.sections,emailLabel:this._emailLabel,nameLabel:this._nameLabel,questionLabel:this._questionLabel,privacyPolicyLabel:this._privacyPolicyLabel,buttonLabel:this._buttonLabel,question:new URLSearchParams(window.location.search.substring(1)).get("query")})}}],[{key:"type",get:function(){return"QASubmission"}}]),n}(),de=(new x).register(P).register(T).register(H).register(X).register(Z).register(ue).register(oe).register(ee).register(te).register(ne).register(ie).register(pe).register(fe);return new(function(){function e(){if(t(this,e),!e.setInstance(this))return e.getInstance();this.renderer=new E.Handlebars,this.components=de,this._onReady=function(){}}return i(e,[{key:"init",value:function(e){var t=this;return this.components.setCore(new q({apiKey:e.apiKey,answersKey:e.answersKey})).setRenderer(this.renderer),this._onReady=e.onReady||function(){},!1===e.useTemplates||e.templateBundle?(e.templateBundle&&this.renderer.init(e.templateBundle),this._onReady.call(this),this):(this.templates=new R({templateUrl:e.templateUrl}).onLoaded(function(e){t.renderer.init(e),t._onReady.call(t)}),this)}},{key:"domReady",value:function(e){U.onReady(e)}},{key:"onReady",value:function(e){return this._onReady=e,this}},{key:"addComponent",value:function(e,t){return"string"==typeof t&&(t={container:t}),this.components.create(e,t).mount(),this}},{key:"createComponent",value:function(e){return this.components.create("Component",e).mount()}},{key:"registerHelper",value:function(e,t){return this.renderer.registerHelper(e,t),this}}],[{key:"setInstance",value:function(e){return!this.instance&&(this.instance=e,!0)}},{key:"getInstance",value:function(e){return this.instance}}]),e}())});