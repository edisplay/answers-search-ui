!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).ANSWERS=t()}(this,function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){r(e,t,n[t])})}return e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t,n){return(l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&u(r,n.prototype),r}).apply(null,arguments)}function c(e){var t="function"==typeof Map?new Map:void 0;return(c=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return l(e,arguments,o(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),u(i,e)})(e)}function h(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e,t,n){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,r=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{i||null==o.return||o.return()}finally{if(r)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function d(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var y="get",v="post",m=function(){function e(){t(this,e)}return i(e,[{key:"get",value:function(e,t,n){return this.request(y,this.encodeParams(e,t),n)}},{key:"post",value:function(e,t,n){return this.request(v,e,Object.assign({body:JSON.stringify(t),credentials:void 0},n))}},{key:"request",value:function(e,t,n){return fetch(t,Object.assign({method:e,credentials:"include"},n))}},{key:"beacon",value:function(e,t){return navigator.sendBeacon(e,JSON.stringify(t))}},{key:"encodeParams",value:function(e,t){var n=e.indexOf("?")>-1,i="";for(var r in t)n?i+="&":(n=!0,i+="?"),i+=r+"="+encodeURIComponent(t[r]);return e+i}}]),e}(),g="https://liveapi.yext.com",_="https://assets.sitescdn.net/answers/answerstemplates.compiled.min.js",b=function(){function e(n){if(t(this,e),this._params={},window&&window.URLSearchParams)return new URLSearchParams(n);this._params=this.parse(n)}return i(e,[{key:"parse",value:function(t){var n={},i=t;if(""===i)return n;t.indexOf("?")>-1&&(i=t.slice(t.indexOf("?")+1));for(var r=i.split("&"),a=0;a<r.length;a++){var s=r[a].split("=");s.length>1?n[s[0]]=e.decode(s[1]):n[s[0]]=""}return n}},{key:"get",value:function(e){return void 0===this._params[String(e)]?null:this._params[e]}},{key:"set",value:function(e,t){this._params[String(e)]=String(t)}},{key:"has",value:function(e){return e in this._params}},{key:"toString",value:function(){var t=[];for(var n in this._params)t.push("".concat(n,"=").concat(e.encode(this._params[n])));return t.join("&")}}],[{key:"decode",value:function(e){return decodeURIComponent(e.replace(/[ +]/g,"%20"))}},{key:"encode",value:function(e){var t={"!":"%21","'":"%27","(":"%28",")":"%29","%20":"+"};return encodeURIComponent(e).replace(/[!'()]|%20/g,function(e){return t[e]})}}]),e}(),k=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),this._requester=new m,this._baseUrl=n.baseUrl||g,this._endpoint=n.endpoint||null,this._apiKey=n.apiKey||null,this._version=n.version||20190101,this._params=n.params||{}}return i(e,[{key:"get",value:function(){return this._requester.get(this._baseUrl+this._endpoint,this.params(this._params))}},{key:"post",value:function(e){return this._requester.post(this._baseUrl+this._endpoint,this.params(this._params),e)}},{key:"params",value:function(e){var t={v:this._version,api_key:this._apiKey},n=new b(window.location.toString());return n.has("beta")&&(t.beta=n.get("beta")),Object.keys(e).forEach(function(t){void 0!==e[t]&&null!==e[t]||delete e[t]}),Object.assign(t,e||{})}}]),e}(),w=function(e){function n(e,i,r,a){var s;return t(this,n),(s=h(this,o(n).call(this,i))).errorCode=e,s.errorMessage=i,s.boundary=r,s.causedBy=a,s.reported=!1,s}return s(n,c(Error)),i(n,[{key:"toJson",value:function(){return JSON.stringify(this)}}],[{key:"from",value:function(e,t){var n=new S(e.message,t);return n.stack=e.stack,n}}]),n}(),S=function(e){function n(e,i,r){return t(this,n),h(this,o(n).call(this,100,e,i,r))}return s(n,w),n}(),C=function(e){function n(e,i,r){return t(this,n),h(this,o(n).call(this,201,e,i,r))}return s(n,w),n}(),E=function(e){function n(e,i,r){return t(this,n),h(this,o(n).call(this,300,e,i,r))}return s(n,w),n}(),I=function(e){function n(e,i,r){return t(this,n),h(this,o(n).call(this,400,e,i,r))}return s(n,w),n}(),O=function(e){function n(e,i,r,a){var s;return t(this,n),(s=h(this,o(n).call(this,401,e,"Storage",a))).storageKey=i,s.data=r,s}return s(n,w),n}(),R=function(e){function n(e,i,r){var a;return t(this,n),(a=h(this,o(n).call(this,402,e,"Analytics",r))).event=i,a}return s(n,w),n}(),A=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t(this,e),!n.apiKey)throw new S("Api Key is required","Search");if(this._apiKey=n.apiKey,!n.answersKey)throw new S("Answers Key is required","Search");if(this._answersKey=n.answersKey,this._version=n.version||20190101,!n.locale)throw new S("Locale is required","Search");this._locale=n.locale}return i(e,[{key:"verticalSearch",value:function(e,t){var n=t.input,i=t.filter,r=t.facetFilter,a=t.limit,s=t.offset,o=t.id,u=t.isDynamicFiltersEnabled;if(a>50)throw new I("Provided search limit unsupported","SearchApi");return new k({endpoint:"/v2/accounts/me/answers/vertical/query",apiKey:this._apiKey,version:this._version,params:{input:n,answersKey:this._answersKey,filters:i,facetFilters:r,verticalKey:e,limit:a,offset:s,queryId:o,retrieveFacets:u,locale:this._locale}}).get().then(function(e){return e.json()})}},{key:"universalSearch",value:function(e){return new k({endpoint:"/v2/accounts/me/answers/query",apiKey:this._apiKey,version:this._version,params:{input:e,answersKey:this._answersKey,locale:this._locale}}).get().then(function(e){return e.json()})}}]),e}(),T=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),this.sections=n.sections||[],this.queryId=n.queryId||"",Object.freeze(this)}return i(e,null,[{key:"from",value:function(t){return new e({sections:t.sections?t.sections.map(function(e){return{label:e.label,results:e.results.map(function(e){return new L(e)})}}):[{results:t.results.map(function(e){return new L(e)})}],queryId:t.queryId})}}]),e}(),L=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),this.filter=n.filter||{},this.highlightedValue=this.highlight(n),this.key=n.key||"",this.matchedSubstrings=n.matchedSubstrings||[],this.value=n.value||"",this.shortValue=n.shortValue||this.value,Object.freeze(this)}return i(e,[{key:"highlight",value:function(e){var t=e.value,n=e.shortValue,i=e.matchedSubstrings,r=t||n;if(!i||0===i.length)return r;i.sort(function(e,t){return e.offset<t.offset?-1:e.offset>t.offset?1:0});for(var a="",s=0,o=0;o<i.length;o++){var u=Number(i[o].offset),l=u+i[o].length;a+=[r.slice(s,u),"<strong>",r.slice(u,l),"</strong>"].join(""),o===i.length-1&&l<r.length&&(a+=r.slice(l)),s=l}return a}}]),e}(),q=function(){function e(){t(this,e)}return i(e,null,[{key:"clean",value:function(e,t){return t.sections&&0===t.sections.length&&delete t.sections,t.sections&&1===t.sections.length&&0===t.sections[0].results.length&&delete t.sections,r({},e,t)}},{key:"universal",value:function(e){return T.from(e)}},{key:"filter",value:function(e){return T.from(e)}},{key:"vertical",value:function(e){return T.from(e)}}]),e}(),x=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t(this,e),!n.apiKey)throw new S("Api Key is required","AutoComplete");if(this._apiKey=n.apiKey,!n.answersKey)throw new S("Answers Key is required","AutoComplete");if(this._answersKey=n.answersKey,this._version=n.version||20190101,!n.locale)throw new S("Locale is required","AutoComplete");this._locale=n.locale}return i(e,[{key:"queryFilter",value:function(e,t,n){return new k({endpoint:"/v2/accounts/me/answers/filtersearch",apiKey:this._apiKey,version:this._version,params:{input:e,answersKey:this._answersKey,experienceKey:t,inputKey:n,locale:this._locale}}).get().then(function(e){return e.json()}).then(function(e){return q.filter(e.response,n)}).catch(function(e){throw new E("Filter search request failed","AutoComplete",e)})}},{key:"queryVertical",value:function(e,t,n){var i=new k({endpoint:"/v2/accounts/me/answers/autocomplete",apiKey:this._apiKey,version:this._version,params:{input:e,answersKey:this._answersKey,experienceKey:t,barKey:n,locale:this._locale}});return i.get().then(function(e){return e.json()}).then(function(e){return q.vertical(e.response,i._params.barKey)}).catch(function(e){throw new E("Vertical search request failed","AutoComplete",e)})}},{key:"queryUniversal",value:function(e){return new k({endpoint:"/v2/accounts/me/answers/autocomplete",apiKey:this._apiKey,version:this._version,params:{input:e,answersKey:this._answersKey,locale:this._locale}}).get(e).then(function(e){return e.json()}).then(function(e){return q.universal(e.response)}).catch(function(e){throw new E("Universal search request failed","AutoComplete",e)})}}]),e}(),M=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t(this,e),!n.apiKey)throw new S("Api Key is required","QuestionAnswerApi");this._apiKey=n.apiKey}return i(e,[{key:"submitQuestion",value:function(e){return new k({endpoint:"/v2/accounts/me/questions",apiKey:this._apiKey,params:{entityId:e.entityId,site:e.site,name:e.name,email:e.email,questionText:e.questionText,questionDescription:e.questionDescription,questionLanguage:e.questionLanguage}}).post().then(function(e){return e.json()}).catch(function(e){throw new E("Question submit failed","QuestionAnswerApi",e)})}}]),e}(),K={PRE_SEARCH:"pre-search",SEARCH_LOADING:"search-loading",SEARCH_COMPLETE:"search-complete"},N=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),this._raw=n.raw||null,this.ordinal=n.ordinal||null,this.title=n.title||null,this.details=n.details||null,this.link=n.link||null,this.id=n.id||null,this.subtitle=n.subtitle||null,this.modifier=n.modifier||null,this.bigDate=n.bigDate||null,this.image=n.image||null,this.callsToAction=n.callsToAction||[]},F=function(){function e(){t(this,e)}return i(e,null,[{key:"from",value:function(t){for(var n=[],i=0;i<t.length;i++){var r=t[i].data||t[i];r.htmlSnippet?n.push(e.fromGoogleCustomSearchEngine(r)):n.push(e.fromGeneric(r,i))}return n}},{key:"fromGeneric",value:function(e,t){return new N({raw:e,title:e.name,details:e.description,link:e.website,id:e.id,ordinal:t+1})}},{key:"fromGoogleCustomSearchEngine",value:function(e){return new N({raw:e,title:e.htmlTitle.replace(/(<([^>]+)>)/gi,""),details:e.htmlSnippet,link:e.link})}}]),e}(),j=function(){function e(n,i){t(this,e),this.searchState=K.SEARCH_COMPLETE,this.verticalConfigId=n.verticalConfigId||null,this.resultsCount=n.resultsCount||0,this.encodedState=n.encodedState||"",this.appliedQueryFilters=U.from(n.appliedQueryFilters),this.facets=n.facets||null,this.results=F.from(n.results),this.map=e.parseMap(n.results),this.verticalURL=i||null}return i(e,null,[{key:"parseMap",value:function(e){for(var t=[],n={},i=0;i<e.length;i++){var r=e[i].data||e[i];r&&r.yextDisplayCoordinate&&(n.latitude||(n={latitude:r.yextDisplayCoordinate.latitude,longitude:r.yextDisplayCoordinate.longitude}),t.push({item:r,label:t.length+1,latitude:r.yextDisplayCoordinate.latitude,longitude:r.yextDisplayCoordinate.longitude}))}return{mapCenter:n,mapMarkers:t}}},{key:"from",value:function(t,n){var i=[];if(!t)return i;if(!Array.isArray(t))return new e(t);for(var r=0;r<t.length;r++)i.push(new e(t[r],n[t[r].verticalConfigId]));return i}}]),e}(),U=function(){function e(n){t(this,e),this.key=n.key||n.displayKey,this.value=n.value||n.displayValue}return i(e,null,[{key:"from",value:function(t){for(var n=[],i=0;i<t.length;i++)n.push(new e(t[i]));return n}}]),e}(),D=function(){function e(n){t(this,e),this.queryId=n.queryId||null,this.sections=n.sections||[],this.searchState=n.searchState||K.SEARCH_COMPLETE}return i(e,null,[{key:"from",value:function(t,n){return new e({queryId:t.queryId,sections:j.from(t.modules,n)})}},{key:"searchLoading",value:function(){return new e({searchState:K.SEARCH_LOADING})}}]),e}(),P=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),Object.assign(this,n),Object.freeze(this)},H=function(){function e(n){t(this,e),this.tabOrder=n||[],Object.freeze(this)}return i(e,null,[{key:"from",value:function(t){var n=[];if(!t||!Array.isArray(t))return n;for(var i=0;i<t.length;i++)n.push(t[i].verticalConfigId);return new e(n)}}]),e}(),Q=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),Object.assign(this,{searchState:K.SEARCH_COMPLETE},n),Object.freeze(this)}return i(e,[{key:"append",value:function(t){var n=a({},this);return n.results=this.results.concat(t.results),n.map.mapMarkers=this.map.mapMarkers.concat(t.map.mapMarkers),new e(n)}}],[{key:"from",value:function(t){return new e(j.from(t))}},{key:"searchLoading",value:function(){return new e({searchState:K.SEARCH_LOADING})}},{key:"areDuplicateNamesAllowed",value:function(){return!0}}]),e}(),V={NAVIGATION:"navigation",UNIVERSAL_RESULTS:"universal-results",VERTICAL_RESULTS:"vertical-results",AUTOCOMPLETE:"autocomplete",DIRECT_ANSWER:"direct-answer",FILTER:"filter",QUERY:"query",QUERY_ID:"query-id",FACET_FILTER:"facet-filter",DYNAMIC_FILTERS:"dynamic-filters",SEARCH_LIMIT:"search-limit",QUESTION_SUBMISSION:"question-submission"},B=function(){function e(n){t(this,e),this.filters=n.filters||[],Object.freeze(this)}return i(e,null,[{key:"from",value:function(t){return new e({filters:t.facets.map(function(e){return{label:e.displayName,fieldId:e.fieldId,options:e.options.map(function(e){return{label:e.displayName,countLabel:e.count,selected:e.selected,filter:e.filter}})}})})}}]),e}(),z=function(){function e(){t(this,e)}return i(e,null,[{key:"transform",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.response;return r(t={},V.QUERY_ID,i.queryId),r(t,V.NAVIGATION,H.from(i.modules)),r(t,V.DIRECT_ANSWER,new P(i.directAnswer)),r(t,V.UNIVERSAL_RESULTS,D.from(i,n)),t}},{key:"transformVertical",value:function(e){var t;return r(t={},V.QUERY_ID,e.response.queryId),r(t,V.NAVIGATION,new H),r(t,V.VERTICAL_RESULTS,Q.from(e.response)),r(t,V.DYNAMIC_FILTERS,B.from(e.response)),t}}]),e}(),J=function(){function e(){t(this,e),this._listeners={}}return i(e,[{key:"on",value:function(e,t,n){if("function"!=typeof t)throw new Error("callback handler should be of type {function}");return void 0===this._listeners[e]&&(this._listeners[e]=[]),this._listeners[e].push({event:e,cb:t,once:n||!1}),this}},{key:"once",value:function(e,t){return this.on(e,t,!0)}},{key:"off",value:function(e){return delete this._listeners[e],this}},{key:"emit",value:function(e,t){var n=this._listeners[e];if(void 0!==n){for(var i=[],r=0;r<n.length;r++)n[r].cb(t),!0!==n[r].once&&i.push(n[r]);return this._listeners[e]=i,this}}}]),e}(),G=function(n){function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t(this,r),(n=h(this,o(r).call(this)))._id=e,n._history=[],n._data={},n.set(i),n}return s(r,J),i(r,[{key:"set",value:function(t){var n=t||{};if(this.capturePrevious(),"object"!==e(t)||Object.keys(n).length!==Object.keys(this._data).length)return this._data=n,void this.emit("update",this._data);for(var i=Object.keys(n),r=0;r<i.length;r++){var a=i[r];if(this._data[a]!==n[a])return this._data=n,void this.emit("update",this._data)}}},{key:"capturePrevious",value:function(){void 0===this._history&&(this._history=[]),this._history.length+1>5&&this._history.shift(),this._history.push(JSON.stringify(this._data||{}))}},{key:"undo",value:function(){var e={};this._previous.length>0&&(e=JSON.parse(this._previous.pop())),this._data.set(e)}},{key:"raw",value:function(){return this._data}}]),r}(),Y=function(){function e(){t(this,e),this._moduleDataContainer={},this._futureListeners={}}return i(e,[{key:"set",value:function(e,t){this._initDataContainer(e,t),this._moduleDataContainer[e].set(t)}},{key:"_initDataContainer",value:function(e,t){if(null==e||"string"!=typeof e)throw new O("Invalid storage key provided",e,t);if(null==t)throw new O("No data provided",e,t);void 0===this._moduleDataContainer[e]&&(this._moduleDataContainer[e]=new G(e),this._applyFutureListeners(e))}},{key:"getState",value:function(e){return this._moduleDataContainer[e]?this._moduleDataContainer[e].raw():null}},{key:"getAll",value:function(e){for(var t=[],n=Object.keys(this._moduleDataContainer),i=0;i<n.length;i++){var r=n[i];r.startsWith(e)&&null!==this._moduleDataContainer[r].raw()&&t.push(this._moduleDataContainer[r].raw())}return t}},{key:"on",value:function(e,t,n){return void 0===this._moduleDataContainer[t]?(void 0===this._futureListeners[t]&&(this._futureListeners[t]=[]),void this._futureListeners[t].push({event:e,cb:n})):(this._moduleDataContainer[t].on(e,n),this)}},{key:"off",value:function(e,t,n){return void 0===this._moduleDataContainer[t]?(void 0!==this._futureListeners[t]&&this._futureListeners[t].pop(),this):(this._moduleDataContainer[t].off(e,n),this)}},{key:"_applyFutureListeners",value:function(e){var t=this._futureListeners[e];if(t){for(var n=0;n<t.length;n++){var i=t[n];this.on(i.event,e,i.cb)}delete this._futureListeners[e]}}}]),e}(),W=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;t(this,e),this.name=n.name||null,this.email=n.email||null,this.privacyPolicy=n.privacyPolicy||null,this.questionText=n.questionText||null,this.questionDescription=n.questionDescription||null,this.errors=i||null,Object.freeze(this)}return i(e,null,[{key:"submitted",value:function(){return{questionSubmitted:!0}}},{key:"errors",value:function(t,n){return e(t,n)}}]),e}(),$=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t(this,e),"string"!=typeof n.apiKey)throw new Error("Missing required `apiKey`. Type must be {string}");if("string"!=typeof n.answersKey)throw new Error("Missing required `answersKey`. Type must be {string}");this._apiKey=n.apiKey,this._answersKey=n.answersKey,this._locale=n.locale||"en",this.storage=new Y,this._searcher=new A({apiKey:this._apiKey,answersKey:this._answersKey,locale:this._locale}),this._autoComplete=new x({apiKey:this._apiKey,answersKey:this._answersKey,locale:this._locale}),this._questionAnswer=new M({apiKey:this._apiKey})}return i(e,[{key:"verticalSearch",value:function(e,t){var n=this;return t.append||this.storage.set(V.VERTICAL_RESULTS,Q.searchLoading()),this._searcher.verticalSearch(e,a({limit:this.storage.getState(V.SEARCH_LIMIT)},t,{isDynamicFiltersEnabled:this._isDynamicFiltersEnabled})).then(function(e){return z.transformVertical(e)}).then(function(e){if(n.storage.set(V.QUERY_ID,e[V.QUERY_ID]),n.storage.set(V.NAVIGATION,e[V.NAVIGATION]),t.append){var i=n.storage.getState(V.VERTICAL_RESULTS).append(e[V.VERTICAL_RESULTS]);n.storage.set(V.VERTICAL_RESULTS,i)}else n.storage.set(V.VERTICAL_RESULTS,e[V.VERTICAL_RESULTS]);e[V.DYNAMIC_FILTERS]&&n.storage.set(V.DYNAMIC_FILTERS,e[V.DYNAMIC_FILTERS])})}},{key:"search",value:function(e,t){var n=this;return this.storage.set(V.UNIVERSAL_RESULTS,D.searchLoading()),this._searcher.universalSearch(e).then(function(e){return z.transform(e,t)}).then(function(i){n.storage.set(V.QUERY_ID,i[V.QUERY_ID]),n.storage.set(V.NAVIGATION,i[V.NAVIGATION]),n.storage.set(V.DIRECT_ANSWER,i[V.DIRECT_ANSWER]),n.storage.set(V.UNIVERSAL_RESULTS,i[V.UNIVERSAL_RESULTS],t),n.storage.set(V.QUESTION_SUBMISSION,new W({questionText:e}))})}},{key:"autoCompleteUniversal",value:function(e,t){var n=this;return this._autoComplete.queryUniversal(e).then(function(e){n.storage.set("".concat(V.AUTOCOMPLETE,".").concat(t),e)})}},{key:"autoCompleteVertical",value:function(e,t,n,i){var r=this;return this._autoComplete.queryVertical(e,n,i).then(function(e){r.storage.set("".concat(V.AUTOCOMPLETE,".").concat(t),e)})}},{key:"autoCompleteFilter",value:function(e,t,n,i){var r=this;return this._autoComplete.queryFilter(e,n,i).then(function(e){r.storage.set("".concat(V.AUTOCOMPLETE,".").concat(t),e)})}},{key:"submitQuestion",value:function(e){var t=this;return this._questionAnswer.submitQuestion(e).then(function(e){t.storage.set(V.QUESTION_SUBMISSION,W.submitted())})}},{key:"setQuery",value:function(e){this.storage.set(V.QUERY,e)}},{key:"setQueryId",value:function(e){this.storage.set(V.QUERY_ID,e)}},{key:"setFilter",value:function(e,t){this.storage.set("".concat(V.FILTER,".").concat(e),t)}},{key:"setFacetFilter",value:function(e,t){this.storage.set("".concat(V.FACET_FILTER,".").concat(e),t)}},{key:"enableDynamicFilters",value:function(){this._isDynamicFiltersEnabled=!0}},{key:"setSearchLimit",value:function(e){this.storage.set(V.SEARCH_LIMIT,e)}},{key:"on",value:function(e,t,n){return this.storage.on(e,t,n)}}]),e}(),X=function(){function e(){if(t(this,e),!e.setInstance(this))return e.getInstance();this._componentRegistry={},this._activeComponents=[],this._core=null,this._renderer=null,this._analyticsReporter=null}return i(e,[{key:"setRenderer",value:function(e){return this._renderer=e,this}},{key:"setCore",value:function(e){return this._core=e,this}},{key:"setAnalyticsReporter",value:function(e){return this._analyticsReporter=e,this}},{key:"register",value:function(e){return this._componentRegistry[e.type]=e,this}},{key:"create",value:function(e,t){if(t=Object.assign({core:this._core,renderer:this._renderer,analyticsReporter:this._analyticsReporter,componentManager:this},t),!this._componentRegistry[e].areDuplicateNamesAllowed()&&this._activeComponents.some(function(e){return e.name===t.name}))throw new C("Another component with name ".concat(t.name," already exists"),e);var n=new this._componentRegistry[e](t).init(t);if(this._activeComponents.push(n),this._core&&null!==this._core.storage){if(void 0===n.moduleId||null===n.moduleId)return n;this._core.storage.on("update",n.moduleId,function(e){n.setState(e)})}return n}},{key:"remove",value:function(e){this._core.storage.off("update",e.moduleId);var t=this._activeComponents.findIndex(function(t){return t.name===e.name});this._activeComponents.splice(t,1)}},{key:"getActiveComponent",value:function(e){return this._activeComponents.find(function(t){return t.constructor.type===e})}}],[{key:"setInstance",value:function(e){return!this.instance&&(this.instance=e,!0)}},{key:"getInstance",value:function(){return this.instance}}]),e}(),Z=function(){function e(){t(this,e)}return i(e,[{key:"render",value:function(e,t){return e}},{key:"registerHelper",value:function(e,t){}},{key:"compile",value:function(e){}}]),e}(),ee={SOY:Z,Handlebars:function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=h(this,o(n).call(this)))._handlebars=i._hb||null,e._templates=i||{},e}return s(n,Z),i(n,[{key:"init",value:function(e){this._handlebars=e._hb,this._templates=e,this._registerCustomHelpers()}},{key:"registerHelper",value:function(e,t){this._handlebars.registerHelper(e,t)}},{key:"compile",value:function(e){return"string"!=typeof e?"":this._handlebars.compile(e)}},{key:"render",value:function(e,t){if(null!==e.template)return e.template(t);try{return this._templates[e.templateName](t)}catch(t){throw new Error("Can not find/render template: "+e.templateName,t)}}},{key:"_registerCustomHelpers",value:function(){this.registerHelper("ifeq",function(e,t,n){return e===t?n.fn(this):n.inverse(this)}),this.registerHelper("ifnoteq",function(e,t,n){return e!==t?n.fn(this):n.inverse(this)}),this.registerHelper("formatPhoneNumber",function(e){var t=(""+e).replace(/\D/g,"").match(/^(1|)?(\d{3})(\d{3})(\d{4})$/);return t?[t[1]?"+1 ":"","(",t[2],") ",t[3],"-",t[4]].join(""):null}),this.registerHelper("assign",function(e,t,n){var i=arguments;(n=i[i.length-1]).data.root||(n.data.root={});for(var r="",a=1;a<i.length-1;a++)r+=i[a];n.data.root[e]=r}),this.registerHelper("json",function(e,t,n){return void 0===e?"":JSON.stringify(e)})}}]),n}()},te=window.document,ne=function(){function e(){t(this,e)}return i(e,null,[{key:"setup",value:function(e,t){te=e}},{key:"create",value:function(e){if("createRange"in te){var t=te.createElement("div"),n=te.createRange().createContextualFragment(e);return t.appendChild(n),t}return(new DOMParser).parseFromString(e,"text/html").body}},{key:"query",value:function(e,t){return void 0===t&&(t=e,e=te),t instanceof HTMLElement||t instanceof Window||t instanceof HTMLDocument?t:e.querySelector(t)}},{key:"queryAll",value:function(e,t){return void 0===t&&(t=e,e=te),null==e&&(e=te),t instanceof HTMLElement||t instanceof HTMLDocument||t instanceof Window?[t]:Array.from(e.querySelectorAll(t))}},{key:"onReady",value:function(t){"complete"!==te.readyState&&"loaded"!==te.readyState&&"interactive"!==te.readyState?e.on(te,"DOMContentLoaded",t):t()}},{key:"createEl",value:function(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=te.createElement(t),r=Object.keys(n),a=0;a<r.length;a++)"class"!==r[a]?i[r[a]]=n[r[a]]:e.addClass(i,n[r[a]]);return i}},{key:"append",value:function(t,n){void 0===n&&(n=t,t=te),"string"==typeof t&&(t=e.query(t)),"string"==typeof n?t.insertAdjacentHTML("afterBegin",n):t.appendChild(n)}},{key:"addClass",value:function(e,t){for(var n=t.split(","),i=n.length,r=0;r<i;r++)e.classList.add(n[r])}},{key:"empty",value:function(e){e.innerHTML=""}},{key:"css",value:function(t,n){var i=e.query(t);for(var r in n)i.style[r]=n[r]}},{key:"attr",value:function(t,n,i){e.query(t).setAttribute(n,i)}},{key:"trigger",value:function(t,n,i){var r=new Event(n,Object.assign({bubbles:!0,cancelable:!0},i||{}));e.query(t).dispatchEvent(r)}},{key:"on",value:function(t,n,i){e.query(t).addEventListener(n,i)}},{key:"off",value:function(t,n,i){e.query(t).removeEventListener(n,i)}},{key:"delegate",value:function(t,n,i,r){var a=e.query(t);a.addEventListener(i,function(e){for(var t=e.target;!t.isEqualNode(a);){if(t.matches(n)){r(e,t);break}t=t.parentNode}})}}]),e}(),ie=function(e){function n(e){var i;return t(this,n),(i=h(this,o(n).call(this)))._state=e||{},i}return s(n,J),i(n,[{key:"init",value:function(e,t){this._set(e,t)}},{key:"set",value:function(e,t){this._set(e,t),this.emit("update")}},{key:"_set",value:function(e,t){void 0===t?this._state=e:this._state[e]=t}},{key:"update",value:function(e){this._state=e,this.emit("update")}},{key:"get",value:function(e){return void 0===e?this._state:this._state[e]}},{key:"has",value:function(e){return void 0!==this._state[e]}},{key:"asJSON",value:function(){return this._state}}]),n}(),re=function(){function e(n,i){t(this,e),this.eventType=n.toUpperCase(),i&&(this.label=i)}return i(e,[{key:"addOptions",value:function(e){return Object.assign(this,e),this}},{key:"toApiEvent",value:function(){return Object.assign({},this)}}]),e}(),ae=function(){function e(n,i,r){var a=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t(this,e),this._businessId=r,this._globalOptions=Object.assign({},s,{answersKey:i}),n.storage.on("update",V.QUERY_ID,function(e){return a.setQueryId(e)})}return i(e,[{key:"setQueryId",value:function(e){this._globalOptions.queryId=e}},{key:"report",value:function(e){if(!(e instanceof re))throw new R("Tried to send invalid analytics event",e);return e.addOptions(this._globalOptions),(new m).beacon("".concat("https://realtimeanalytics.yext.com","/realtimeanalytics/data/answers/").concat(this._businessId),{data:e.toApiEvent()})}}]),e}(),se=function(){function n(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t(this,n),"object"===e(i)&&(i=(r=i).type),this.moduleId=null,this.name=r.name||this.constructor.name,this._config=r,this._type=this.constructor.name,this._parent=r.parent||null,this._children=[],this._state=new ie(r.state),this.core=r.core||null,this.componentManager=r.componentManager||null,this.analyticsReporter=r.analyticsReporter||null,this._analyticsOptions=r.analyticsOptions||{},null===this._parent){if("string"!=typeof r.container)throw new Error("Missing `container` option for component configuration. Must be of type `string`.");this._container=ne.query(r.container)||null}else this._container=ne.query(this._parent._container,r.container),null===this._container&&(this._container=ne.createEl("div",{class:r.container.substring(1,r.container.length)}),ne.append(this._parent._container,this._container));if(null===this._container)throw new Error("Cannot find container DOM node: "+r.container);this._className=r.class||"component",this._render=r.render||null,this._renderer=r.renderer||ee.Handlebars,this._template=r.template?this._renderer.compile(r.template):null,this._templateName=r.templateName||this.constructor.defaultTemplateName(r),this._isMounted=!1,this.transformData=r.transformData||this.transformData||function(){},this.onCreate=r.onCreate||this.onCreate||function(){},this.onMount=r.onMount||this.onMount||function(){},this.onUpdate=r.onUpdate||this.onUpdate||function(){}}return i(n,[{key:"init",value:function(e){var t=this;return this.setState(e.data||e.state||{}),this.onCreate(),this._state.on("update",function(){t.onUpdate(),t.mount()}),ne.addClass(this._container,this._className),this}},{key:"setState",value:function(e){var t=Object.assign({},{_config:this._config},e);return this._state.set(t),this}},{key:"getState",value:function(e){return this._state.get(e)}},{key:"hasState",value:function(e){return this._state.has(e)}},{key:"transformData",value:function(e){return e}},{key:"addChild",value:function(e,t,n){var i=this.componentManager.create(t,Object.assign({name:e.name,parent:this,data:e},n||{},{_parentOpts:this._config}));return this._children.push(i),i}},{key:"remove",value:function(){this._children.forEach(function(e){return e.remove()}),this.unMount(),this.componentManager.remove(this)}},{key:"setRender",value:function(e){return this._render=e,this}},{key:"setRenderer",value:function(e){return this._renderer=ee[e],this}},{key:"setTemplate",value:function(e){this._template=this._renderer.compile(e)}},{key:"unMount",value:function(){ne.empty(this._container)}},{key:"mount",value:function(){if(!this._container)return this;if(this.unMount(),!1===this.beforeMount())return this;(ne.append(this._container,this.render(this._state.asJSON())),this._isMounted=!0,this._onMount(),this.analyticsReporter)&&ne.queryAll(this._container,"[data-eventtype]:not([data-is-analytics-attached])").forEach(this._createAnalyticsHook.bind(this));return this}},{key:"_onMount",value:function(){this.onMount(this),0!==this._children.length&&this._children.forEach(function(e){e._onMount()})}},{key:"render",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._state.get();this.beforeRender(),t=this.transformData(t);var n="";if("function"==typeof this._render){if("string"!=typeof(n=this._render(t)))throw new Error("Render method must return HTML as type {string}")}else n=this._renderer.render({template:this._template,templateName:this._templateName},t);var i=ne.create(n);return ne.queryAll(i,"[data-component]").forEach(function(n){return e._createSubcomponent(n,t)}),this.afterRender(),i.innerHTML}},{key:"_createSubcomponent",value:function(e,t){var n=e.dataset,i=n.component,r=n.prop,a=n.opts?JSON.parse(n.opts):{};a=Object.assign(a,{container:e});var s=t[r];if(Array.isArray(s)){for(var o=[],u=0;u<s.length;u++){var l=this.addChild(s[u],i,a);o.push(l.render())}ne.append(e,o.join(""))}else{var c=this.addChild(s,i,a);ne.append(e,c.render())}}},{key:"_createAnalyticsHook",value:function(e){var t=this;e.dataset.isAnalyticsAttached=!0;var n=e.dataset,i=n.eventtype,r=n.eventlabel,a=n.eventoptions?JSON.parse(n.eventoptions):{};ne.on(e,"click",function(e){var n=new re(i,r);n.addOptions(t._analyticsOptions),n.addOptions(a),t.analyticsReporter.report(n)})}},{key:"onCreate",value:function(e){}},{key:"onUpdate",value:function(e){}},{key:"beforeRender",value:function(e){}},{key:"afterRender",value:function(e){}},{key:"onMount",value:function(e){}},{key:"onUnMount",value:function(e){}},{key:"beforeMount",value:function(e){}},{key:"onDestroy",value:function(e){}}],[{key:"defaultTemplateName",value:function(e){return"default"}},{key:"areDuplicateNamesAllowed",value:function(){return!1}},{key:"type",get:function(){return"Component"}}]),n}(),oe=function(){function e(n){if(t(this,e),this.label=n.label,"string"!=typeof this.label)throw new C("label is a required configuration option for tab.","NavigationComponent");if(this.url=n.url,"string"!=typeof this.url)throw new C("url is a required configuration option for tab.","NavigationComponent");this.configId=n.configId||null,this.baseUrl=n.url,this.isFirst=n.isFirst||!1,this.isActive=n.isActive||!1}return i(e,null,[{key:"from",value:function(t){for(var n={},i=0;i<t.length;i++){var r=t[i];void 0===r.configId&&void 0===n[r.configId]&&(r.configId=r.url),n[r.configId]=new e(r)}return n}}]),e}(),ue=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=h(this,o(n).call(this,i))).moduleId=V.NAVIGATION,e._tabs=oe.from(i.tabs),e._tabOrder=e.getDefaultTabOrder(i.tabs,e.getUrlParams()),e}return s(n,se),i(n,[{key:"setState",value:function(e){void 0!==e.tabOrder&&(this._tabOrder=this.mergeTabOrder(e.tabOrder,this._tabOrder));for(var t=[],i=0;i<this._tabOrder.length;i++){var r=this._tabs[this._tabOrder[i]];void 0!==r&&(r.url=this.generateTabUrl(r.baseUrl,this.getUrlParams()),t.push(r))}return f(o(n.prototype),"setState",this).call(this,{tabs:t})}},{key:"getUrlParams",value:function(){return new b(window.location.search.substring(1))}},{key:"getDefaultTabOrder",value:function(e,t){var n=[];t&&t.has("tabOrder")&&(n=t.get("tabOrder").split(","));for(var i=0;i<e.length;i++){var r=e[i];void 0===r.configId&&(r.configId=r.url),n.includes(r.configId)||(r.isFirst?n.unshift(r.configId):n.push(r.configId))}return n}},{key:"mergeTabOrder",value:function(e,t){for(var n=0;n<t.length;n++){var i=t[n];e.includes(i)||(this._tabs[i]&&this._tabs[i].isFirst?e.unshift(i):e.push(i))}return e}},{key:"generateTabUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new URLSearchParams;return t.set("tabOrder",this._tabOrder),e+"?"+t.toString()}}],[{key:"defaultTemplateName",value:function(e){return"navigation/navigation"}},{key:"type",get:function(){return"Navigation"}}]),n}(),le=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),Object.assign(this,n),Object.freeze(this)}return i(e,null,[{key:"fromResponse",value:function(t){return new e(JSON.parse(t))}},{key:"or",value:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return new e({$or:n})}},{key:"and",value:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return new e({$and:n})}},{key:"group",value:function(){for(var t={},n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];for(var a=0;a<i.length;a++){var s=i[a],o=Object.keys(s)[0];t[o]||(t[o]=[]),t[o].push(s)}for(var u=[],l=Object.keys(t),c=0;c<l.length;c++){var h=l[c];u.push(t[h].length>1?e.or.apply(e,d(t[h])):t[h][0])}return u.length>1?e.and.apply(e,u):u[0]}},{key:"equal",value:function(t,n){return e._fromMatcher(t,"$eq",n)}},{key:"lessThan",value:function(t,n){return e._fromMatcher(t,"$lt",n)}},{key:"lessThanEqual",value:function(t,n){return e._fromMatcher(t,"$le",n)}},{key:"greaterThan",value:function(t,n){return e._fromMatcher(t,"$gt",n)}},{key:"greaterThanEqual",value:function(t,n){return e._fromMatcher(t,"$ge",n)}},{key:"inclusiveRange",value:function(t,n,i){return new e(r({},t,{$ge:n,$le:i}))}},{key:"exclusiveRange",value:function(t,n,i){return new e(r({},t,{$gt:n,$lt:i}))}},{key:"_fromMatcher",value:function(t,n,i){return new e(r({},t,r({},n,i)))}}]),e}(),ce=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=h(this,o(n).call(this,i)))._barKey=i.barKey||null,e._verticalKey=i.verticalKey||null,e._formEl=i.formSelector||"form",e._inputEl=i.inputEl||".js-yext-query",e.title=i.title||"Answers Universal Search",e.labelText=i.labelText||"What are you interested in?",e.submitText=i.submitText||"Submit",e.submitIcon=i.submitIcon||null,e.promptHeader=i.promptHeader||null,e.autoFocus=!0===i.autoFocus,e.redirectUrl=i.redirectUrl||null,e.query=i.query||e.getUrlParams().get("query")||"",e._searchCooldown=i.searchCooldown||300,e}return s(n,se),i(n,[{key:"onCreate",value:function(){this.query&&this.query.length>0&&(this.core.setQuery(this.query),this.search(this.query)),this.bindBrowserHistory()}},{key:"onMount",value:function(){this.initSearch(this._formEl),this.initAutoComplete(this._inputEl),!0===this.autoFocus&&0===this.query.length&&ne.query(this._container,this._inputEl).focus()}},{key:"initSearch",value:function(e){var t=this;this._formEl=e;var n=ne.query(this._container,e);if(!n)throw new Error("Could not initialize SearchBar; Can not find {HTMLElement} `",this._formEl,"`.");ne.on(n,"submit",function(e){e.preventDefault();var i=n.querySelector(t._inputEl),r=i.value,a=t.getUrlParams();return a.set("query",r),"string"==typeof t.redirectUrl?(window.location.href=t.redirectUrl+"?"+a.toString(),!1):(window.history.pushState({query:r},r,"?"+a.toString()),i.blur(),t.core.setQuery(r),t.search(r),!1)})}},{key:"initAutoComplete",value:function(e){var t=this;this._inputEl=e,this.componentManager.create("AutoComplete",{parent:this,name:"".concat(this.name,".autocomplete"),container:".yext-search-autocomplete",barKey:this._barKey,verticalKey:this._verticalKey,promptHeader:this.promptHeader,originalQuery:this.query,inputEl:e,onSubmit:function(){ne.trigger(t._formEl,"submit")}})}},{key:"search",value:function(e){var t=this;if(!this._throttled){if(this._throttled=!0,setTimeout(function(){t._throttled=!1},this._searchCooldown),this._verticalKey){var n=this.core.storage.getAll(V.FILTER),i=n.length>1?le.and.apply(le,d(n)):n[0],r=this.core.storage.getAll(V.FACET_FILTER)[0];return this.core.verticalSearch(this._verticalKey,{input:e,filter:JSON.stringify(i),facetFilter:JSON.stringify(r)})}var a=this.componentManager.getActiveComponent("Navigation");if(a){var s=a.getState("tabs"),o={};if(s&&Array.isArray(s))for(var u=0;u<s.length;u++){var l=this.getUrlParams(s[u].url.split("?")[1]);l.set("query",e);var c=s[u].baseUrl;l.toString().length>0&&(c+="?"+l.toString()),o[s[u].configId]=c}return this.core.search(e,o)}return this.core.search(e)}}},{key:"setState",value:function(e){return f(o(n.prototype),"setState",this).call(this,Object.assign({title:this.title,labelText:this.labelText,submitIcon:this.submitIcon,submitText:this.submitText,query:this.query},e))}},{key:"getUrlParams",value:function(e){return e=e||window.location.search.substring(1),new b(e)}},{key:"bindBrowserHistory",value:function(){var e=this;ne.on(window,"popstate",function(){e.query=e.getUrlParams().get("query"),e.setState({query:e.query}),e.core.setQuery(e.query),e.search(e.query)})}}],[{key:"defaultTemplateName",value:function(e){return"search/search"}},{key:"type",get:function(){return"SearchBar"}}]),n}(),he=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=h(this,o(n).call(this,i)))._barKey=i.barKey||i.inputKey||null,e._verticalKey=i.verticalKey||null,e._storeOnChange=i.storeOnChange||!1,e._formEl=i.formSelector||"form",e._inputEl=i.inputEl||".js-yext-query",e.title=i.title,e.searchText=i.searchText||"What are you interested in?",e.promptHeader=i.promptHeader||null,e.autoFocus=!0===i.autoFocus,e.redirectUrl=i.redirectUrl||null,e.query=i.query||e.getUrlParams().get("".concat(e.name,".query"))||"",e.filter=i.filter||e.getUrlParams().get("".concat(e.name,".filter"))||"",e}return s(n,se),i(n,[{key:"onCreate",value:function(){if(this.query&&this.query.length>0&&this.filter&&this.filter.length>0){var e=this.getUrlParams();e.set("".concat(this.name,".query"),this.query),e.set("".concat(this.name,".filter"),this.filter),window.history.pushState({},"","?"+e.toString()),this.core.setFilter(this.name,le.fromResponse(this.filter)),this.search()}this.bindBrowserHistory()}},{key:"onMount",value:function(){this.initAutoComplete(this._inputEl),!0===this.autoFocus&&0===this.query.length&&ne.query(this._container,this._inputEl).focus()}},{key:"initAutoComplete",value:function(e){var t=this;this._inputEl=e,this.componentManager.create("AutoComplete",{parent:this,name:"".concat(this.name,".autocomplete"),isFilterSearch:!0,container:".yext-search-autocomplete",promptHeader:this.promptHeader,originalQuery:this.query,originalFilter:this.filter,inputEl:e,verticalKey:this._verticalKey,barKey:this._barKey,onSubmit:function(e,n){var i=t.getUrlParams();if(i.set("".concat(t.name,".query"),e),i.set("".concat(t.name,".filter"),n),"string"==typeof t.redirectUrl)return window.location.href=t.redirectUrl+"?"+i.toString(),!1;window.history.pushState({},"","?"+i.toString()),t.core.setFilter(t.name,le.fromResponse(n)),t.search()}})}},{key:"search",value:function(){if(!this._storeOnChange){var e=this.core.storage.getAll(V.FILTER),t=e[0];e.length>1&&(t=le.and.apply(le,d(e)));var n=this.core.storage.getState(V.QUERY)||"",i=this.core.storage.getAll(V.FACET_FILTER)[0];this.core.verticalSearch(this._verticalKey,{input:n,filter:JSON.stringify(t),facetFilter:JSON.stringify(i)})}}},{key:"setState",value:function(e){return f(o(n.prototype),"setState",this).call(this,Object.assign({title:this.title,searchText:this.searchText,query:this.query,filter:this.filter},e))}},{key:"getUrlParams",value:function(e){return e=e||window.location.search.substring(1),new b(e)}},{key:"bindBrowserHistory",value:function(){var e=this;ne.on(window,"popstate",function(){e.query=e.getUrlParams().get("".concat(e.name,".query")),e.filter=e.getUrlParams().get("".concat(e.name,".filter")),e.setState({query:e.query,filter:e.filter}),e._saveQueryAndFilter(e.query,e.filter),e.search()})}}],[{key:"defaultTemplateName",value:function(e){return"search/filtersearch"}},{key:"type",get:function(){return"FilterSearch"}}]),n}(),fe=9,pe=13,de=16,ye=17,ve=18,me=27,ge=37,_e=39,be=38,ke=40,we=91,Se=92,Ce=93,Ee=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=h(this,o(n).call(this,i))).isFilterSearch=i.isFilterSearch||!1,e._barKey=i.barKey||null,e._verticalKey=i.verticalKey||null,e._inputEl=i.inputEl||".js-yext-query",e._autocompleteEls=i.autoCompleteEls||".js-yext-autocomlete-option",e.moduleId="".concat(V.AUTOCOMPLETE,".").concat(e.name),e._originalQuery=i.originalQuery||"",e._sectionIndex=0,e._resultIndex=-1,e.promptHeader=i.promptHeader||null,e._onSubmit=i.onSubmit||function(){},e}return s(n,se),i(n,[{key:"setState",value:function(e){f(o(n.prototype),"setState",this).call(this,Object.assign({},e,{sectionIndex:this._sectionIndex,resultIndex:this._resultIndex,promptHeader:0===this._originalQuery.length?this.promptHeader:null}))}},{key:"updateState",value:function(){this.setState(this._state.get())}},{key:"onCreate",value:function(){var e=this,t=ne.query(this._parent._container,this._inputEl);if(!t)throw new Error("Could not initialize AutoComplete. Can not find {HTMLElement} `",this._inputEl,"`.");ne.attr(t,"autoComplete","off"),ne.on(document,"click",function(t){t.target.matches(".js-yext-autocomplete-container *")||t.target.matches(e._inputEl)||e.close()}),ne.on(t,"focus",function(){e.reset(),e.autoComplete(t.value)}),ne.on(t,"keydown",function(n){e.handleNavigateResults(n.keyCode,n),e.handleSubmitResult(n.keyCode,t.value,n)}),ne.delegate(this._container,".js-yext-autocomplete-option","click",function(t,n){var i=n.dataset,r=i.short;e.updateQuery(r),e._onSubmit(r,i.filter),e.close()}),ne.on(t,"keyup",function(n){e.handleTyping(n.keyCode,t.value,n)})}},{key:"close",value:function(){this.setState({}),this.reset()}},{key:"reset",value:function(){this._sectionIndex=0,this._resultIndex=-1,this.updateState()}},{key:"updateQuery",value:function(e){void 0===e&&(e=this._state.get("sections")[this._sectionIndex].results[this._resultIndex].shortValue);ne.query(this._parent._container,".js-yext-query").value=e}},{key:"handleTyping",value:function(e,t,n){if(!([ke,be,ye,ve,de,ge,_e,we,Se,pe,Ce].indexOf(e)>-1))return e===me?(this.updateQuery(this._originalQuery),void this.close()):void(e!==fe?(this._originalQuery=t,this.reset(),this.autoComplete(t)):this.close())}},{key:"autoComplete",value:function(e){this.isFilterSearch?this.core.autoCompleteFilter(e,this.name,this._verticalKey,this._barKey):this._verticalKey||this._barKey?this.core.autoCompleteVertical(e,this.name,this._verticalKey,this._barKey):this.core.autoCompleteUniversal(e,this.name)}},{key:"handleNavigateResults",value:function(e,t){var n=this._state.get("sections");if(!(void 0===n||n.length<=0)){var i=n[this._sectionIndex].results;if(e===be)return t.preventDefault(),this._resultIndex<=0?this._sectionIndex>0?(this._sectionIndex--,this._resultIndex=n[this._sectionIndex].results.length-1,this.updateQuery(),void this.updateState()):(this.updateQuery(this._originalQuery),void this.reset()):(this._resultIndex--,this.updateState(),void this.updateQuery());if(e===ke){if(t.preventDefault(),this._resultIndex>=i.length-1)return this._sectionIndex<n.length-1&&(this._sectionIndex++,this._resultIndex=0),this.updateQuery(),void this.updateState();this._resultIndex++,this.updateQuery(),this.updateState()}}}},{key:"handleSubmitResult",value:function(e,t,n){var i=this._state.get("sections");if(void 0===i||i.length<=0)this.isFilterSearch&&this.autoComplete(t);else if(e===pe){if(n.preventDefault(),this.isFilterSearch&&-1===this._resultIndex)return;var r="";this._sectionIndex>=0&&this._resultIndex>=0&&(r=JSON.stringify(i[this._sectionIndex].results[this._resultIndex].filter)),this.updateQuery(t),this._originalQuery=t,this._onSubmit(t,r),this.close()}}}],[{key:"defaultTemplateName",value:function(e){return"search/autocomplete"}},{key:"type",get:function(){return"AutoComplete"}}]),n}(),Ie=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),Object.assign(this,n),Object.freeze(this)}return i(e,null,[{key:"fromFilters",value:function(){for(var t={},n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return i.flatMap(function(e){return e.$or||e}).forEach(function(e){var n=Object.keys(e)[0];t[n]||(t[n]=[]),t[n].push(e)}),new e(t)}}]),e}(),Oe=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t(this,n),e=h(this,o(n).call(this,i)),!(i.filters&&i.filters instanceof Array))throw new C("FilterBox requires filters to be provided as an array","FilterBox");return e._filterConfigs=i.filters,e._verticalKey=i.verticalKey||null,e._searchOnChange=i.searchOnChange||!1,e._applyButtonSelector=i.applyButtonSelector||".js-yext-filterbox-apply",e._filterComponents=[],e._filters=[],e._isDynamic=i.isDynamic||!1,e._templateName="filters/filterbox",e}return s(n,se),i(n,[{key:"setState",value:function(e){f(o(n.prototype),"setState",this).call(this,Object.assign(e,{filterConfigs:this._filterConfigs,showApplyButton:!this._searchOnChange}))}},{key:"onMount",value:function(){var e=this;this._filterComponents.length&&(this._filterComponents.forEach(function(e){return e.remove()}),this._filterComponents=[],this._filters=[]);for(var t=function(t){var n=e._filterConfigs[t],i=e.componentManager.create(n.type,Object.assign({},n,{parent:e,name:"".concat(e.name,".filter").concat(t),storeOnChange:!1,container:".js-yext-filterbox-filter".concat(t),onChange:function(n){e.onFilterChange(t,n)}}));i.mount(),e._filterComponents.push(i),e._filters[t]=i.getFilter()},n=0;n<this._filterConfigs.length;n++)t(n);if(!this._searchOnChange){var i=ne.query(this._container,this._applyButtonSelector);i&&ne.on(i,"click",function(){e._saveFiltersToStorage(),e._search()})}}},{key:"onFilterChange",value:function(e,t){this._filters[e]=t,this._searchOnChange&&(this._saveFiltersToStorage(),this._search())}},{key:"remove",value:function(){this._filterComponents.forEach(function(e){return e.remove()}),f(o(n.prototype),"remove",this).call(this)}},{key:"_saveFiltersToStorage",value:function(){var e=this._filters.filter(function(e){return null!=e&&Object.keys(e).length>0});if(this._isDynamic){var t=Ie.fromFilters.apply(Ie,d(e));this.core.setFacetFilter(this.name,t||{})}else{var n=e.length>1?le.and.apply(le,d(e)):e[0];this.core.setFilter(this.name,n||{})}}},{key:"_search",value:function(){var e=this.core.storage.getAll(V.FILTER),t=e.length>1?le.and.apply(le,d(e)):e[0],n=this.core.storage.getState(V.QUERY),i=this.core.storage.getAll(V.FACET_FILTER)[0];this.core.verticalSearch(this._verticalKey,{input:n,filter:JSON.stringify(t),facetFilter:JSON.stringify(i)})}}],[{key:"type",get:function(){return"FilterBox"}}]),n}(),Re=["singleoption","multioption"],Ae=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t(this,n),e=h(this,o(n).call(this,i)),!i.control||!Re.includes(i.control))throw new C('FilterOptions requires a valid "control" to be provided',"FilterOptions");if(!i.options)throw new C("FilterOptions component requires options to be provided","FilterOptions");return e._options=i.options.map(function(e){return Object.assign({},{selected:!1},e)}),e._control=i.control,e._optionSelector=i.optionSelector||".js-yext-filter-option",e._storeOnChange=i.storeOnChange||!1,e._onChange=i.onChange||function(){},e._label=i.label||"",e._label=i.label||"Filters",e}return s(n,se),i(n,[{key:"setState",value:function(e){f(o(n.prototype),"setState",this).call(this,Object.assign({},e,{name:this.name.toLowerCase(),options:this._options,label:this._label}))}},{key:"onMount",value:function(){var e=this;ne.delegate(ne.query(this._container,".".concat(this._control,"-fieldset")),this._optionSelector,"click",function(t){e._updateOption(parseInt(t.target.dataset.index),t.target.checked);var n=e._buildFilter();e._storeOnChange&&e.core.setFilter(e.name,n),e._onChange(n)})}},{key:"_updateOption",value:function(e,t){"singleoption"===this._control&&(this._options=this._options.map(function(e){return Object.assign({},e,{selected:!1})})),this._options[e]=Object.assign({},this._options[e],{selected:t}),this.setState()}},{key:"getFilter",value:function(){return this._buildFilter()}},{key:"clear",value:function(){ne.queryAll(this._container,this._optionSelector).forEach(function(e){return e.setAttribute("checked","false")}),this._applyFilter()}},{key:"_buildFilter",value:function(){var e=this._options.filter(function(e){return e.selected}).map(function(e){return e.filter?e.filter:le.equal(e.field,e.value)});return e.length>0?le.group.apply(le,d(e)):{}}}],[{key:"defaultTemplateName",value:function(e){return"controls/".concat(e.control)}},{key:"type",get:function(){return"FilterOptions"}}]),n}(),Te=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=h(this,o(n).call(this,i)))._field=i.field,e._onChange=i.onChange||function(){},e._storeOnChange=i.storeOnChange||!1,e._range={min:i.initialMin||0,max:i.initialMax||10},e._title=i.title,e._minLabel=i.minLabel||null,e._maxLabel=i.maxLabel||null,e._templateName="controls/range",e}return s(n,se),i(n,[{key:"setState",value:function(e){f(o(n.prototype),"setState",this).call(this,Object.assign({},e,{name:this.name,title:this._title,minLabel:this._minLabel,maxLabel:this._maxLabel,minValue:this._range.min,maxValue:this._range.max}))}},{key:"onCreate",value:function(){var e=this;ne.delegate(this._container,".js-yext-range","change",function(t){e._updateRange(t.target.dataset.key,Number.parseInt(t.target.value))})}},{key:"setMin",value:function(e){this._updateRange("min",e)}},{key:"setMax",value:function(e){this._updateRange("max",e)}},{key:"getFilter",value:function(){return this._buildFilter()}},{key:"_updateRange",value:function(e,t){this._range=Object.assign({},this._range,r({},e,t)),this.setState();var n=this._buildFilter();this._storeOnChange&&this.core.setFilter(this.name,n),this._onChange(n)}},{key:"_buildFilter",value:function(){return le.inclusiveRange(this._field,this._range.min,this._range.max)}}],[{key:"type",get:function(){return"RangeFilter"}}]),n}(),Le=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,n),(e=h(this,o(n).call(this,i)))._field=i.field,e._title=i.title,e._minLabel=i.minLabel||null,e._maxLabel=i.maxLabel||null,e._onChange=i.onChange||function(){},e._storeOnChange=i.storeOnChange||!1,e._isExclusive=i.isExclusive,e._templateName="controls/date";var r=new Date,a="".concat(r.getFullYear(),"-").concat("".concat(r.getMonth()+1).padStart(2,"0"),"-").concat("".concat(r.getDate()).padStart(2,"0"));return e._date={min:i.initialMin||a,max:i.initialMax||a},e}return s(n,se),i(n,[{key:"setState",value:function(e){f(o(n.prototype),"setState",this).call(this,Object.assign({},e,{name:this.name,title:this._title,minLabel:this._minLabel,maxLabel:this._maxLabel,dateMin:this._date.min,dateMax:this._date.max}))}},{key:"onCreate",value:function(){var e=this;ne.delegate(this._container,".js-yext-date","change",function(t){e._updateRange(t.target.dataset.key,t.target.value)})}},{key:"setMin",value:function(e){this._updateRange("min",e)}},{key:"setMax",value:function(e){this._updateRange("max",e)}},{key:"getFilter",value:function(){return this._buildFilter()}},{key:"_updateRange",value:function(e,t){this._date=Object.assign({},this._date,r({},e,t)),this.setState();var n=this._buildFilter();this._storeOnChange&&this.core.setFilter(this.name,n),this._onChange(n)}},{key:"_buildFilter",value:function(){return""===this._date.min||""===this._date.max?{}:this._isExclusive?le.exclusiveRange(this._field,this._date.min,this._date.max):le.inclusiveRange(this._field,this._date.min,this._date.max)}}],[{key:"type",get:function(){return"DateRangeFilter"}}]),n}(),qe=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=h(this,o(n).call(this,i)))._verticalKey=i.verticalKey||null,e._searchOnChange=i.searchOnChange||!1,e._applyButtonSelector=i.applyButtonSelector||null,e._fieldControls=i.fieldControls||{},e._templateName="filters/dynamic",e.moduleId=V.DYNAMIC_FILTERS,e._filterbox=null,e}return s(n,se),i(n,[{key:"onMount",value:function(){var e=this;this.core.enableDynamicFilters(),this._filterbox&&this._filterbox.remove();var t=this._state.get().filters;t&&(t=t.map(function(t){return Object.assign({},t,{type:"FilterOptions",control:e._fieldControls[t.fieldId]||"multioption"})}),this._filterbox=this.componentManager.create("FilterBox",Object.assign({},{parent:this,name:"".concat(this.name,".filterbox"),container:".js-yext-dynamic-filters",searchOnChange:this._searchOnChange,verticalKey:this._verticalKey,isDynamic:!0,filters:t})),this._filterbox.mount())}}],[{key:"type",get:function(){return"DynamicFilters"}}]),n}(),xe="THUMBS_UP",Me="THUMBS_DOWN",Ke=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=h(this,o(n).call(this,i))).moduleId=V.DIRECT_ANSWER,e._formEl=i.formEl||".js-directAnswer-feedback-form",e._thumbsUpSelector=i.thumbsUpSelector||".js-directAnswer-thumbDown",e._thumbsDownSelector=i.thumbsDownSelector||".js-directAnswer-thumbUp",e}return s(n,se),i(n,[{key:"beforeMount",value:function(){return!!this.hasState("answer")}},{key:"onMount",value:function(){var e=this;if(!0===this.getState("feedbackSubmitted"))return this;ne.on(this._formEl,"submit",function(t){var n=t.target,i=ne.query(n,"input:checked").value;e.reportQuality(i),e.updateState({feedbackSubmitted:!0})}),ne.on(this._thumbsUpSelector,"click",function(){ne.trigger(e._formEl,"submit")}),ne.on(this._thumbsDownSelector,"click",function(){ne.trigger(e._formEl,"submit")})}},{key:"updateState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},this.getState(),e);this.setState(t)}},{key:"reportQuality",value:function(e){var t=new re(!0===e?xe:Me).addOptions({directAnswer:!0});this.analyticsReporter.report(t)}}],[{key:"defaultTemplateName",value:function(e){return"results/directanswer"}},{key:"type",get:function(){return"DirectAnswer"}}]),n}(),Ne=function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),h(this,o(n).call(this,e))}return s(n,se),i(n,null,[{key:"defaultTemplateName",value:function(e){return"results/resultsitem"}},{key:"areDuplicateNamesAllowed",value:function(){return!0}},{key:"type",get:function(){return"ResultsItemComponent"}}]),n}(),Fe=function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),h(this,o(n).call(this,e))}return s(n,Ne),i(n,null,[{key:"defaultTemplateName",value:function(e){return"results/locationresultsitem"}},{key:"areDuplicateNamesAllowed",value:function(){return!0}},{key:"type",get:function(){return"LocationResultsItemComponent"}}]),n}(),je=function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),h(this,o(n).call(this,e))}return s(n,Ne),i(n,null,[{key:"defaultTemplateName",value:function(e){return"results/eventresultsitem"}},{key:"areDuplicateNamesAllowed",value:function(){return!0}},{key:"type",get:function(){return"EventResultsItemComponent"}}]),n}(),Ue=function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),h(this,o(n).call(this,e))}return s(n,Ne),i(n,null,[{key:"defaultTemplateName",value:function(e){return"results/peopleresultsitem"}},{key:"areDuplicateNamesAllowed",value:function(){return!0}},{key:"type",get:function(){return"PeopleResultsItemComponent"}}]),n}(),De=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),this._apiKey=n.apiKey,this._height=n.height||200,this._width=n.width||600,this._zoom=n.zoom||9,this._defaultPosition=n.defaultPosition||{lat:37.0902,lng:-95.7129},this._showEmptyMap=n.showEmptyMap||!1,this._map=null,this._isLoaded=!1,this._onPinClick=n.onPinClick||null,this._onLoaded=n.onLoaded||function(){},this._pinConfig="function"==typeof n.pin?n.pin:Object.assign(e.DEFAULT_PIN_CONFIG,n.pin)}return i(e,[{key:"onLoaded",value:function(e){"function"==typeof e&&(this._onLoaded=e,this.isLoaded()&&this._onLoaded())}},{key:"isLoaded",value:function(){return this._isLoaded}},{key:"loadJS",value:function(){throw new Error("Unimplemented Method: loadJS")}},{key:"loadStatic",value:function(){throw new Error("Unimplemented Method: loadStatic")}},{key:"init",value:function(e){throw new Error("Unimplemented Method: init")}},{key:"_collapseMarkers",value:function(e){var t={};e.forEach(function(e){t["".concat(e.latitude).concat(e.longitude)]?t["".concat(e.latitude).concat(e.longitude)].push(e):t["".concat(e.latitude).concat(e.longitude)]=[e]});for(var n=[],i=Object.entries(t),r=0;r<i.length;r++){var a=p(i[r],2)[1];if(a.length>1){var s={item:a.map(function(e){return e.item}),label:a.length,latitude:a[0].latitude,longitude:a[0].longitude};n.push(s)}else n.push(a[0])}return n}}],[{key:"DEFAULT_PIN_CONFIG",get:function(){return{icon:{anchor:null,svg:null,url:null,scaledSize:null},labelType:"numeric"}}}]),e}(),Pe=function(e){function n(e){var i;if(t(this,n),(i=h(this,o(n).call(this,e)))._clientId=e.clientId,i._signature=e.signature,!i.hasValidClientCredentials()&&!i._apiKey)throw new Error("GoogleMapsProvider: Missing `apiKey` or {`clientId`, `signature`}");return i}return s(n,De),i(n,[{key:"loadJS",value:function(e){var t=this;if(ne.query("#yext-map-js"))"function"==typeof e&&e();else{var n=ne.createEl("script",{id:"yext-map-js",onload:function(){t._isLoaded=!0,t._onLoaded()},async:!0,src:"//maps.googleapis.com/maps/api/js?".concat(this.generateCredentials())});ne.append("body",n)}}},{key:"generateStatic",value:function(e){var t=He.from(e.mapMarkers,this._pinConfig),n=He.serialize(t);return'\n      <img src="//maps.googleapis.com/maps/api/staticmap?'.concat(n,"&size=").concat(this._width,"x").concat(this._height,"&").concat(this.generateCredentials(),'">')}},{key:"generateCredentials",value:function(){return this.hasValidClientCredentials()?"client=".concat(this._clientId):"key=".concat(this._apiKey)}},{key:"hasValidClientCredentials",value:function(){return this._clientId&&(this._signature||!this._isStatic)}},{key:"init",value:function(e,t){var n=this;if((!t||t.mapMarkers.length<=0)&&!this._showEmptyMap)return this._map=null,this;setTimeout(function(){var i=ne.query(e);ne.css(i,{width:n._width,height:n._height}),n.map=new google.maps.Map(i,{zoom:n._zoom});var r=n._collapseMarkers(t.mapMarkers),a=new google.maps.LatLngBounds;if(t&&t.mapMarkers.length){for(var s=He.from(r,n._pinConfig,n.map),o=function(e){var t=new google.maps.Marker(s[e]);n._onPinClick&&t.addListener("click",function(){return n._onPinClick(r[e].item)}),a.extend(t.position)},u=0;u<s.length;u++)o(u);n.map.fitBounds(a)}else n.map.setCenter(new google.maps.LatLng(n._defaultPosition.lat,n._defaultPosition.lng))},100)}}]),n}(),He=function(){function e(n){t(this,e),this.map=n.map||void 0,this.position=n.position||{lat:void 0,lng:void 0},this.icon=n.icon||void 0,this.label=n.label||void 0}return i(e,null,[{key:"serialize",value:function(e){var t=[];return e.forEach(function(e){t.push("markers=label:".concat(e.label,"|").concat(e.position.lat,",").concat(e.position.lng))}),t.join("&")}},{key:"from",value:function(t,n,i){var r=[];return Array.isArray(t)||(t=[t]),t.forEach(function(t){var a=n;"function"==typeof n&&(a=n(t.item,De.DEFAULT_PIN_CONFIG,t));var s,o={};a.anchor&&(o.anchor=google.maps.Point(a.anchor.x,a.anchor.y)),a.scaledSize&&(o.scaledSize=google.maps.Size(a.scaledSize.w,a.scaledSize.h)),a.url&&(o.url=a.url),a.svg&&(o.url="data:image/svg+xml;charset=utf-8, ".concat(encodeURIComponent(a.svg))),s=a.label?a.label:t.label.toString(),0===Object.keys(o).length&&(o=void 0),r.push(new e({map:i,position:{lat:t.latitude,lng:t.longitude},icon:o,label:s}))}),r}}]),e}(),Qe=function(e){function n(){return t(this,n),h(this,o(n).apply(this,arguments))}return s(n,De),i(n,[{key:"loadJS",value:function(e){var t=this,n=ne.createEl("script",{id:"yext-map-js",onload:function(){t._isLoaded=!0,mapboxgl.accessToken=t._apiKey,"function"==typeof e&&e(),"function"==typeof t._onLoaded&&t._onLoaded()},async:!0,src:"https://api.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.js"}),i=ne.createEl("link",{id:"yext-map-css",rel:"stylesheet",href:"https://api.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.css"});ne.append("body",i),ne.append("body",n)}},{key:"generateStatic",value:function(e){var t=Ve.from(e.mapMarkers,this._pinConfig),n=e.mapCenter,i=this._width||600,r=this._height||200,a=this._zoom||9,s=Ve.serialize(t);return'<img src="https://api.mapbox.com/styles/v1/mapbox/streets-v11/static/'.concat(s,"/").concat(n.longitude,",").concat(n.latitude,",").concat(a,"/auto/").concat(i,"x").concat(r,"?access_token=").concat(this._apiKey,'">')}},{key:"init",value:function(e,t){var n=this;if((!t||t.mapMarkers.length<=0)&&!this._showEmptyMap)return this._map=null,this;var i=ne.query(e);ne.css(i,{width:this._width,height:this._height}),this._map=new mapboxgl.Map({container:i,zoom:this._zoom,style:"mapbox://styles/mapbox/streets-v9",center:this.getCenterMarker(t)}),t&&function(){for(var e=n._collapseMarkers(t.mapMarkers),i=Ve.from(e,n._pinConfig,n._map),r=function(t){var r=i[t].wrapper,a=new mapboxgl.LngLat(i[t].position.longitude,i[t].position.latitude),s=new mapboxgl.Marker(r).setLngLat(a);s.addTo(n._map),n._onPinClick&&s.getElement().addEventListener("click",function(){return n._onPinClick(e[t].item)})},a=0;a<i.length;a++)r(a)}()}},{key:"getCenterMarker",value:function(e){return e&&e.mapCenter&&e.mapCenter.longitude&&e.mapCenter.latitude?[e.mapCenter.longitude,e.mapCenter.latitude]:{lng:this._defaultPosition.lng,lat:this._defaultPosition.lat}}}]),n}(),Ve=function(){function e(n){t(this,e),this.map=n.map||void 0,this.position=n.position||{latitude:void 0,longitude:void 0},this.wrapper=n.wrapper||void 0,this.label=n.label||void 0,this.staticMapPin=n.staticMapPin||void 0}return i(e,null,[{key:"serialize",value:function(e){var t=[];return e.forEach(function(e){e.staticMapPin?t.push("url-".concat(e.staticMapPin,"(").concat(e.position.longitude,",").concat(e.position.latitude,")")):t.push("pin-s-".concat(e.label,"(").concat(e.position.longitude,",").concat(e.position.latitude,")"))}),t.join(",")}},{key:"from",value:function(t,n,i){var r=[];return Array.isArray(t)||(t=[t]),t.forEach(function(t){var a=n;"function"==typeof n&&(a=n(t.item,De.DEFAULT_PIN_CONFIG,t));var s=a.wrapper?a.wrapper:null,o=a.staticMapPin?a.staticMapPin:null;r.push(new e({map:i,position:{latitude:t.latitude,longitude:t.longitude},wrapper:s,label:t.label,staticMapPin:o}))}),r}}]),e}(),Be={google:Pe,mapbox:Qe},ze=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t(this,n),(e=h(this,o(n).call(this,i))).moduleId=V.VERTICAL_RESULTS,e._mapProvider=i.mapProvider,!(e._mapProvider&&e._mapProvider.toLowerCase()in Be))throw new Error("MapComponent: Invalid Map Provider; must be `google` or `mapBox`");return e._isStatic=i.isStatic||!1,e._map=null,e}return s(n,se),i(n,[{key:"getProviderInstance",value:function(e){return new(Be[e.toLowerCase()])(this._config)}},{key:"onCreate",value:function(){this._map=this.getProviderInstance(this._mapProvider);var e=this.getState("map");return void 0===e&&this._isStatic?this:this._isStatic?(this.setTemplate(this._map.generateStatic(e)),this):void this._map.loadJS()}},{key:"onMount",value:function(){var e=this;this._map.onLoaded(function(){e._map.init(e._container,e.getState("map"))})}},{key:"setState",value:function(e,t){return 0===Object.keys(e).length?this:f(o(n.prototype),"setState",this).call(this,e,t)}}],[{key:"defaultTemplateName",value:function(e){return"results/map"}},{key:"type",get:function(){return"Map"}}]),n}(),Je="event",Ge="location",Ye="people",We=function(e){function n(){var e,i,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t(this,n),(i=h(this,o(n).call(this,a))).moduleId=V.VERTICAL_RESULTS,i._itemConfig=(r(e={global:{render:null,template:null}},je.type,{render:null,template:null}),r(e,Fe.type,{render:null,template:null}),r(e,Ue.type,{render:null,template:null}),e),void 0===a.renderItem&&void 0!==a._parentOpts&&(a.renderItem=a._parentOpts.renderItem),void 0===a.itemTemplate&&void 0!==a._parentOpts&&(a.itemTemplate=a._parentOpts.itemTemplate),a.limit){var s=a.limit;if("number"!=typeof s||s<1||s>50)throw new C("Search Limit must be between 1 and 50","VerticalResults");i.core.setSearchLimit(s)}return i.configureItem({render:a.renderItem,template:a.itemTemplate}),i}return s(n,se),i(n,[{key:"mount",value:function(){return Object.keys(this.getState()).length>0&&f(o(n.prototype),"mount",this).call(this),this}},{key:"setState",value:function(e,t){var i=e.searchState||K.PRE_SEARCH;return f(o(n.prototype),"setState",this).call(this,Object.assign({results:[]},e,{isPreSearch:i===K.PRE_SEARCH,isSearchLoading:i===K.SEARCH_LOADING,isSearchComplete:i===K.SEARCH_COMPLETE,includeMap:this._config.includeMap,mapConfig:this._config.mapConfig}),t)}},{key:"configureItem",value:function(e){if("function"==typeof e.render)this._itemConfig.global.render=e.render;else for(var t in e.render)this.setItemRender(t,e.render[t]);if("string"==typeof e.template)this._itemConfig.global.template=e.template;else for(var n in e.template)this.setItemTemplate(n,e.template[n])}},{key:"setItemTemplate",value:function(e,t){var n=this.getItemComponent(e);this._itemConfig[n.type].template=t}},{key:"setItemRender",value:function(e,t){var n=this.getItemComponent(e);this._itemConfig[n.type].render=t}},{key:"getItemComponent",value:function(e){var t=Ne;switch(e){case Je:t=je;break;case Ge:t=Fe;break;case Ye:t=Ue}return t}},{key:"addChild",value:function(e,t,i){if(t===Ne.type){var r=this.getItemComponent(e.type);r&&(t=r.type)}else if(t===ze.type){e={map:e};var a=Object.assign({},this._config.mapConfig,i);return f(o(n.prototype),"addChild",this).call(this,e,t,a)}var s=f(o(n.prototype),"addChild",this).call(this,e,t,i),u=this._itemConfig.global,l=this._itemConfig[s.type],c="function"==typeof u.render,h="string"==typeof u.template;return c&&s.setRender(u.render),h&&s.setTemplate(u.template),l?(!c&&l.render&&s.setRender(l.render),!h&&l.template&&s.setTemplate(l.template),s):s}}],[{key:"defaultTemplateName",value:function(e){return"results/results"}},{key:"duplicatesAllowed",get:function(){return!0}},{key:"type",get:function(){return"VerticalResults"}}]),n}(),$e=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=h(this,o(n).call(this,i))).moduleId=V.UNIVERSAL_RESULTS,e._limit=i.limit||10,e}return s(n,se),i(n,[{key:"init",value:function(e){return f(o(n.prototype),"init",this).call(this,e),this}},{key:"setState",value:function(e,t){var i=e.searchState||K.PRE_SEARCH;return f(o(n.prototype),"setState",this).call(this,Object.assign({sections:[]},e,{isPreSearch:i===K.PRE_SEARCH,isSearchLoading:i===K.SEARCH_LOADING,isSearchComplete:i===K.SEARCH_COMPLETE}),t)}},{key:"addChild",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,i=this.getChildConfig([e.verticalConfigId]);return f(o(n.prototype),"addChild",this).call(this,e,t,i)}},{key:"getChildConfig",value:function(e){return void 0===this._config.config?{}:this._config.config[e]||this._config.config}}],[{key:"defaultTemplateName",value:function(e){return"results/universalresults"}},{key:"areDuplicateNamesAllowed",value:function(){return!0}},{key:"type",get:function(){return"UniversalResults"}}]),n}(),Xe={entityId:null,language:"EN",formSelector:"form",emailLabel:"Email Address:",nameLabel:"Name:",questionLabel:"What is your question?",privacyPolicyLabel:"I agree to our Privacy Policy:",buttonLabel:"Submit"},Ze=function(e){function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,n),(e=h(this,o(n).call(this,Object.assign({},Xe,i)))).moduleId=V.QUESTION_SUBMISSION,e.validateConfig(),e}return s(n,se),i(n,[{key:"validateConfig",value:function(){if(null===this._config.entityId||"number"!=typeof this._config.entityId)throw new C("`entityId` is a required configuration option for Question Submission","QuestionSubmission")}},{key:"beforeMount",value:function(){return Object.keys(this.getState()).length>1}},{key:"onMount",value:function(){var e=ne.query(this._container,this._config.formSelector);null!==e&&(this.bindAnalytics(e),this.bindFormSubmit(e))}},{key:"bindAnalytics",value:function(e){var t=this;if(null!==this.analyticsReporter){var n=ne.query(e,".js-question-text");ne.on(n,"focus",function(){t.analyticsReporter.report(new re("QUESTION_FOCUS"))})}}},{key:"bindFormSubmit",value:function(e){var t=this;ne.on(e,"submit",function(n){n.preventDefault();var i=t.parse(e),r=t.validateRequired(i);if(r)return t.setState(new W(i,r));t.core.submitQuestion({entityId:t._config.entityId,questionLanguage:t._config.language,site:"FIRST_PARTY",name:i.name,email:i.email,questionText:i.questionText,questionDescription:i.questionDescription}).catch(function(e){throw t.setState(new W(i,{network:"There was a problem submitting your question. Please try again."})),e})})}},{key:"parse",value:function(e){var t=ne.queryAll(e,".js-question-field");if(!t||0===t.length)return{};for(var n={},i=0;i<t.length;i++){var r=t[i].value;"checkbox"===t[i].type&&"true"===r&&(r=!0),n[t[i].name]=r}return n}},{key:"validateRequired",value:function(e){var t={};return e.email&&"string"==typeof e.email||(t.email="Missing email address!"),e.privacyPolicy&&!0===e.privacyPolicy||(t.privacyPolicy="Approving our privacy policy terms is required!"),e.questionText&&"string"==typeof e.questionText||(t.questionText="Question text is required!"),Object.keys(t).length>0?t:null}}],[{key:"defaultTemplateName",value:function(e){return"questions/questionsubmission"}},{key:"type",get:function(){return"QASubmission"}}]),n}(),et=(new X).register(se).register(ue).register(ce).register(he).register(Ee).register(Oe).register(Ae).register(Te).register(Le).register(qe).register(Ke).register($e).register(We).register(Ne).register(Fe).register(je).register(Ue).register(ze).register(Ze),tt=function(){function e(n){if(t(this,e),!e.setInstance(this))return e.getInstance();this._templateUrl=n.templateUrl||_,this._templates={},this._onLoaded=function(){},this._init()}return i(e,[{key:"_init",value:function(){this.fetchTemplates()}},{key:"fetchTemplates",value:function(){var e=this;if(!ne.query("#yext-answers-templates"))return new Promise(function(t,n){var i=ne.createEl("script",{id:"yext-answers-templates",onload:t,onerror:n,async:!0,src:e._templateUrl});ne.append("body",i)}).then(function(e){console.log("Templates loaded successfully!")}),this}},{key:"register",value:function(e){return this._templates=e,this._onLoaded(this._templates),this}},{key:"onLoaded",value:function(e){return this._onLoaded=e,this}},{key:"get",value:function(e){return this._templates[e]}},{key:"getTemplates",value:function(){return this._templates}}],[{key:"setInstance",value:function(e){return!this.instance&&(this.instance=e,!0)}},{key:"getInstance",value:function(){return this.instance}}]),e}(),nt=function(){function e(n,i){t(this,e),this.apiKey=n,this.answersKey=i}return i(e,[{key:"report",value:function(e){if(e instanceof w&&!e.reported)return e.reported=!0,new k({endpoint:"/v2/accounts/me/answers/errors",apiKey:this.apiKey,version:20190301,params:{error:e.toJson(),libVersion:"v0.7.5",answersKey:this.answersKey}}).get().catch(console.err),e}}]),e}();return new(function(){function e(){if(t(this,e),!e.setInstance(this))return e.getInstance();this.renderer=new ee.Handlebars,this.components=et,this._onReady=function(){}}return i(e,[{key:"init",value:function(e){var t=this,n=new $({apiKey:e.apiKey,answersKey:e.answersKey,locale:e.locale});return this.components.setCore(n).setRenderer(this.renderer),e.businessId&&this.components.setAnalyticsReporter(new ae(n,e.answersKey,e.businessId,e.analyticsOptions)),this._onReady=e.onReady||function(){},!1===e.useTemplates||e.templateBundle?(e.templateBundle&&this.renderer.init(e.templateBundle),this._onReady(),this):(this.templates=new tt({templateUrl:e.templateUrl}).onLoaded(function(e){t.renderer.init(e),t._onReady()}),e.suppressErrorReports||(this._errorReporter=new nt(e.apiKey,e.answersKey),window.addEventListener("error",function(e){return t._errorReporter.report(e.error)}),window.addEventListener("unhandledrejection",function(e){return t._errorReporter.report(e.error)})),this)}},{key:"domReady",value:function(e){ne.onReady(e)}},{key:"onReady",value:function(e){return this._onReady=e,this}},{key:"addComponent",value:function(e,t){return"string"==typeof t&&(t={container:t}),this.components.create(e,t).mount(),this}},{key:"createComponent",value:function(e){return this.components.create("Component",e).mount()}},{key:"registerHelper",value:function(e,t){return this.renderer.registerHelper(e,t),this}}],[{key:"setInstance",value:function(e){return!this.instance&&(this.instance=e,!0)}},{key:"getInstance",value:function(){return this.instance}}]),e}())});